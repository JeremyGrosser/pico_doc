<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>User-Defined References</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    SPAN.insert4 {text-decoration: underline; color: rgb(153,0,0) }
    SPAN.delete4 {text-decoration: line-through; color: rgb(153,0,0) }
    SPAN.insert5 {text-decoration: underline; color: rgb(0,102,0) }
    SPAN.delete5 {text-decoration: line-through; color: rgb(0,102,0) }
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-bottom: 0.6em}
    DIV.Indented1 {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.8em; margin-bottom: 0.6em}
    DIV.Examples {font-family: "Courier New", monospace; font-size: 90%; line-height: 122%; margin-left: 4.0em; margin-bottom: 0.6em}
    DIV.WideHanging-Body {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 7.8em; margin-top: 0em; margin-bottom: 0.6em}
    DIV.WideHanging-Term {float: left; font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-top: 0em; margin-bottom: 0em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,51,153)"><B>Annotated</B></SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)"><B>&nbsp;Ada Reference Manual</B> (Ada 2022 Draft 35)</SPAN> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-4-1-4.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-4-1-6.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>4.1.5 User-Defined References</H1>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum"><a name="p1">1/3</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0139-2.TXT">AI05-0139-2</A></I>} 
Given a discriminated type <I>T</I>, the following type-related operational 
aspect may be specified:</div>
<div class="paranum"><a name="p2">2/3</a></div>
<div class="WideHanging-Term">Implicit_Dereference</div><div class="WideHanging-Body"><br clear="left">
This aspect is specified by a <SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN> 
that denotes an access discriminant declared for the type <I>T</I>.<A NAME="I2815"></A><A NAME="I2816"></A></div>
<div class="paranum"><a name="p2.a">2.a/3</a></div>
<div class="Annotations"><B>Aspect Description for&nbsp;</B><B>Implicit_Dereference: 
</B>Mechanism for user-defined implicit .<B>all</B>.</div>
<div class="paranum"><a name="p3">3/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0139-2.TXT">AI05-0139-2</A></I>} 
A (view of a) type with a specified Implicit_Dereference aspect is a 
<I>reference type</I>.<A NAME="I2817"></A> A <I>reference object</I> 
is an object of a reference type.<A NAME="I2818"></A> The discriminant 
named by the Implicit_Dereference aspect is the <I>reference discriminant</I> 
of the reference type or reference object.<A NAME="I2819"></A> [A <SPAN Class="swiss"><A HREF="AA-4-1-5.html#S0104">generalized_reference</A></SPAN> 
is a <SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN> 
that identifies a reference object, and denotes the object or subprogram 
designated by the reference discriminant of the reference object.]</div>
<div class="paranum"><a name="p3.a">3.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>Term entry:&nbsp;</B><B>reference 
type</B> &mdash; type that has user-defined behavior for &ldquo;.all&rdquo;, 
defined by the Implicit_Dereference aspect</span></div>

<H4 Class="centered">Syntax</H4>
<div class="paranum"><a name="p4">4/3</a></div>
<div class="Indented1">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0139-2.TXT">AI05-0139-2</A></I>} 
<SPAN Class="swiss">generalized_reference</SPAN><A NAME="I2820"></A><A NAME="S0104"></A><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN><I>reference_object_</I><A NAME="I2821"></A><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN></div>

<H4 Class="centered">Name Resolution Rules</H4>
<div class="paranum"><a name="p5">5/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0139-2.TXT">AI05-0139-2</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0269-1.TXT">AI05-0269-1</A></I>} 
The expected type for the <I>reference_object_</I><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN> 
in a <SPAN Class="swiss"><A HREF="AA-4-1-5.html#S0104">generalized_reference</A></SPAN> 
is any reference type.<A NAME="I2822"></A>&nbsp;</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum"><a name="p5.1">5.1/4</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0138-1.TXT">AI12-0138-1</A></I>} 
<span class="insert4">The Implicit_Dereference aspect is nonoverridable 
(see <A HREF="AA-13-1-1.html">13.1.1</A>).<A NAME="I2823"></A></span></div>
<div class="paranum"><a name="p5.a">5.a/4</a></div>
<div class="Annotations"><span class="insert4"><B>Reason:&nbsp;</B>This ensures 
that all descendants of a reference type have the same reference discriminant. 
This prevents generic contract problems with formal derived types.</span> 
</div>
<div class="paranum"><a name="p6">6/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0139-2.TXT">AI05-0139-2</A></I>} 
A <SPAN Class="swiss"><A HREF="AA-4-1-5.html#S0104">generalized_reference</A></SPAN> 
denotes a view equivalent to that of a dereference of the reference discriminant 
of the reference object.</div>
<div class="paranum"><a name="p7">7/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0139-2.TXT">AI05-0139-2</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0203-1.TXT">AI12-0203-1</A></I>} 
Given a reference type <I>T</I>, the Implicit_Dereference aspect is inherited 
by descendants of type <I>T</I> if not overridden<span class="insert5">&nbsp;[(which is only permitted if confirming)]</span>. If a descendant type 
constrains the value of the reference discriminant of <I>T</I> by a new 
discriminant, that new discriminant is the reference discriminant of 
the descendant. [If the descendant type constrains the value of the reference 
discriminant of <I>T</I> by an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN> 
other than the <SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN> 
of a new discriminant, a <SPAN Class="swiss"><A HREF="AA-4-1-5.html#S0104">generalized_reference</A></SPAN> 
that identifies an object of the descendant type denotes the object or 
subprogram designated by the value of this constraining expression.]</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum"><a name="p8">8/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0139-2.TXT">AI05-0139-2</A></I>} 
<A NAME="I2824"></A>The evaluation of a <SPAN Class="swiss"><A HREF="AA-4-1-5.html#S0104">generalized_reference</A></SPAN> 
consists of the evaluation of the <I>reference_object_</I><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN> 
and a determination of the object or subprogram designated by the reference 
discriminant of the named reference object. <A NAME="I2825"></A><A NAME="I2826"></A>A 
check is made that the value of the reference discriminant is not the 
null access value. <A NAME="I2827"></A>Constraint_Error is raised if 
this check fails. The <SPAN Class="swiss"><A HREF="AA-4-1-5.html#S0104">generalized_reference</A></SPAN> 
denotes the object or subprogram designated by the value of the reference 
discriminant of the named reference object.</div>

<H4 Class="centered">Examples</H4>
<div class="paranum"><a name="p9">9/5</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0429-1.TXT">AI12-0429-1</A></I>} 
<span class="insert5"><I>Examples of the specification and use of generalized 
references:</I></span></div>
<div class="paranum"><a name="p10">10/3</a></div>
<div class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0268-1.TXT">AI05-0268-1</A></I>} 
<B>type</B>&nbsp;Barrel&nbsp;<B>is&nbsp;tagged</B>&nbsp;...&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>holds&nbsp;objects&nbsp;of&nbsp;type&nbsp;Element</I></SPAN></div>
<div class="paranum"><a name="p11">11/3</a></div>
<div class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0139-2.TXT">AI05-0139-2</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0299-1.TXT">AI05-0299-1</A></I>} 
<B>type</B>&nbsp;Ref_Element(Data&nbsp;:&nbsp;<B>access</B>&nbsp;Element)&nbsp;<B>is&nbsp;limited&nbsp;private</B><BR>
&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Implicit_Dereference&nbsp;=&gt;&nbsp;Data;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>This&nbsp;Ref_Element&nbsp;type&nbsp;is&nbsp;a&nbsp;&quot;reference&quot;&nbsp;type.</I></SPAN><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>&quot;Data&quot;&nbsp;is&nbsp;its&nbsp;reference&nbsp;discriminant.</I></SPAN></div>
<div class="paranum"><a name="p12">12/3</a></div>
<div class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0139-2.TXT">AI05-0139-2</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0268-1.TXT">AI05-0268-1</A></I>} 
<B>function</B>&nbsp;Find&nbsp;(B&nbsp;:&nbsp;<B>aliased&nbsp;in&nbsp;out</B>&nbsp;Barrel;&nbsp;Key&nbsp;:&nbsp;String)<BR>
&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;Ref_Element;<BR>
&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>Returns&nbsp;a&nbsp;reference&nbsp;to&nbsp;an&nbsp;element&nbsp;of&nbsp;a&nbsp;barrel.</I></SPAN></div>
<div class="paranum"><a name="p13">13/3</a></div>
<div class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0268-1.TXT">AI05-0268-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0299-1.TXT">AI05-0299-1</A></I>} 
B:&nbsp;<B>aliased</B>&nbsp;Barrel;</div>
<div class="paranum"><a name="p14">14/3</a></div>
<div class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0139-2.TXT">AI05-0139-2</A></I>} 
...</div>
<div class="paranum"><a name="p15">15/3</a></div>
<div class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0139-2.TXT">AI05-0139-2</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0268-1.TXT">AI05-0268-1</A></I>} 
Find&nbsp;(B,&nbsp;&quot;grape&quot;)&nbsp;:=&nbsp;Element'(...);&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>Assign&nbsp;through&nbsp;a&nbsp;reference.</I></SPAN></div>
<div class="paranum"><a name="p16">16/3</a></div>
<div class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0139-2.TXT">AI05-0139-2</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0268-1.TXT">AI05-0268-1</A></I>} 
--&nbsp;<SPAN Class="roman"><I>This&nbsp;is&nbsp;equivalent&nbsp;to:</I></SPAN><BR>
Find&nbsp;(B,&nbsp;&quot;grape&quot;).Data.<B>all</B>&nbsp;:=&nbsp;Element'(...);</div>

<H4 Class="centered">Extensions to Ada 2005</H4>
<div class="paranum"><a name="p16.a">16.a/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0139-2.TXT">AI05-0139-2</A></I>} 
<A NAME="I2828"></A>The aspect Implicit_Dereference and the <SPAN Class="swiss"><A HREF="AA-4-1-5.html#S0104">generalized_reference</A></SPAN> 
are new.&nbsp;</div>

<H4 Class="centered">Incompatibilities With Ada 2012</H4>
<div class="paranum"><a name="p16.b">16.b/4</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0138-1.TXT">AI12-0138-1</A></I>} 
<span class="insert4"><A NAME="I2829"></A><B>Corrigendum:</B> Defined 
Implicit_Dereference to be nonoveridable, which makes redefinitions and 
hiding of the aspect illegal. It's possible that some program could violate 
one of these new restrictions, but this is not very likely as reference 
types are not likely to be used in a hierarchy.</span>&nbsp;</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-4-1-4.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-4-1-6.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
