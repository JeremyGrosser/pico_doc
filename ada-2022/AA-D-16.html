<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Multiprocessor Implementation</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    SPAN.insert4 {text-decoration: underline; color: rgb(153,0,0) }
    SPAN.delete4 {text-decoration: line-through; color: rgb(153,0,0) }
    SPAN.insert5 {text-decoration: underline; color: rgb(0,102,0) }
    SPAN.delete5 {text-decoration: line-through; color: rgb(0,102,0) }
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.8em; margin-bottom: 0.6em}
    DIV.Examples {font-family: "Courier New", monospace; font-size: 90%; line-height: 122%; margin-left: 4.0em; margin-bottom: 0.6em}
    DIV.WideHanging-Body {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 7.8em; margin-top: 0em; margin-bottom: 0.6em}
    DIV.WideHanging-Term {float: left; font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-top: 0em; margin-bottom: 0em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,51,153)"><B>Annotated</B></SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)"><B>&nbsp;Ada Reference Manual</B> (Ada 2022 Draft 35)</SPAN> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-D-15.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-D-16-1.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>D.16 Multiprocessor Implementation</H1>
<div class="paranum"><a name="p1">1/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0171-1.TXT">AI05-0171-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0299-1.TXT">AI05-0299-1</A></I>} 
This subclause allows implementations on multiprocessor platforms to 
be configured.&nbsp;</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum"><a name="p2">2/3</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0171-1.TXT">AI05-0171-1</A></I>} 
The following language-defined library package exists:&nbsp;</div>
<div class="paranum"><a name="p3">3/5</a></div>
<div class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0241-1.TXT">AI12-0241-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0302-1.TXT">AI12-0302-1</A></I>} 
<B>package</B>&nbsp;System.Multiprocessors<span class="delete5">&nbsp;<B>is</B></span><A NAME="I10085"></A><BR>
&nbsp;&nbsp;&nbsp;<span class="insert5"><B>with</B></span><span class="delete5"><B>&nbsp;pragma</B></span>&nbsp;Preelaborate<span class="insert5">,&nbsp;Nonblocking,&nbsp;Global&nbsp;=&gt;&nbsp;<B>in&nbsp;out&nbsp;synchronized</B>&nbsp;<B>is</B></span><span class="delete5">(Multiprocessors);</span></div>
<div class="paranum"><a name="p4">4/3</a></div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;<A NAME="I10086"></A>CPU_Range&nbsp;<B>is&nbsp;range</B>&nbsp;0&nbsp;..&nbsp;<SPAN Class="roman"><I>implementation-defined</I></SPAN>;<BR>
&nbsp;&nbsp;&nbsp;<A NAME="I10087"></A>Not_A_Specific_CPU&nbsp;:&nbsp;<B>constant</B>&nbsp;CPU_Range&nbsp;:=&nbsp;0;<BR>
&nbsp;&nbsp;&nbsp;<B>subtype</B>&nbsp;<A NAME="I10088"></A>CPU&nbsp;<B>is</B>&nbsp;CPU_Range&nbsp;<B>range</B>&nbsp;1&nbsp;..&nbsp;CPU_Range'Last;</div>
<div class="paranum"><a name="p4.a.1">4.a.1/3</a></div>
<div class="Annotations"><B>Implementation defined:&nbsp;</B>The value of 
CPU_Range'Last in System.Multiprocessors.</div>
<div class="paranum"><a name="p5">5/3</a></div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I10089"></A>Number_Of_CPUs&nbsp;<B>return</B>&nbsp;CPU;<BR>
<B>end</B>&nbsp;System.Multiprocessors;</div>
<div class="paranum"><a name="p6">6/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0171-1.TXT">AI05-0171-1</A></I>} 
A call of Number_Of_CPUs returns the number of processors available to 
the program. Within a given partition, each call on Number_Of_CPUs will 
return the same value.</div>
<div class="paranum"><a name="p7">7/5</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0281-1.TXT">AI12-0281-1</A></I>} 
For a task type (including the anonymous type of a <SPAN Class="swiss"><A HREF="AA-9-1.html#S0245">single_task_declaration</A></SPAN>)<span class="insert5">, 
protected type (including the anonymous type of a <SPAN Class="swiss"><A HREF="AA-9-4.html#S0250">single_protected_declaration</A></SPAN>),</span> 
or subprogram, the following language-defined representation aspect may 
be specified:</div>
<div class="paranum"><a name="p8">8/3</a></div>
<div class="WideHanging-Term">CPU</div><div class="WideHanging-Body">
The aspect CPU is an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN>, 
which shall be of type System.Multiprocessors.CPU_Range.<A NAME="I10090"></A><A NAME="I10091"></A></div>
<div class="paranum"><a name="p8.a">8.a/5</a></div>
<div class="Annotations"><B>Aspect Description for&nbsp;</B><B>CPU:&nbsp;</B>Processor 
on which a given task<span class="insert5">, or calling task for a protected 
operation,</span> should run.</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum"><a name="p9">9/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0171-1.TXT">AI05-0171-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
If the CPU aspect is specified for a subprogram, the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN> 
shall be static.</div>
<div class="paranum"><a name="p10">10/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0281-1.TXT">AI12-0281-1</A></I>} 
The CPU aspect shall not be specified on a task <span class="insert5">or 
protected&nbsp;</span>interface type.</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum"><a name="p11">11/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0171-1.TXT">AI05-0171-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0081-1.TXT">AI12-0081-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0281-1.TXT">AI12-0281-1</A></I>} 
The <SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN> 
specified for the CPU aspect of a task<span class="insert4"></span><span class="insert5">&nbsp;or protected</span><span class="insert4">&nbsp;type</span> is evaluated <span class="delete4">for 
</span>each <span class="insert4">time an</span><span class="delete4">&nbsp;task</span> 
object <span class="insert4">of the&nbsp;</span><span class="insert5">corresponding</span><span class="insert4"></span><span class="insert4"><span class="delete5">&nbsp;task</span></span><span class="insert4">&nbsp;type is created&nbsp;</span>(see <A HREF="AA-9-1.html">9.1</A><span class="insert5">&nbsp;and <A HREF="AA-9-4.html">9.4</A></span>). The CPU value is then associated 
with the <span class="delete5">task&nbsp;</span>object<span class="delete4">&nbsp;whose task declaration specifies the aspect</span>.</div>
<div class="paranum"><a name="p12">12/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0171-1.TXT">AI05-0171-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
The CPU aspect has no effect if it is specified for a subprogram other 
than the main subprogram; the CPU value is not associated with any task.</div>
<div class="paranum"><a name="p13">13/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0171-1.TXT">AI05-0171-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
The CPU value is associated with the environment task if the CPU aspect 
is specified for the main subprogram. If the CPU aspect is not specified 
for the main subprogram it is implementation defined on which processor 
the environment task executes.&nbsp;</div>
<div class="paranum"><a name="p13.a.1">13.a.1/3</a></div>
<div class="Annotations"><B>Implementation defined:&nbsp;</B>The processor 
on which the environment task executes in the absence of a value for 
the aspect CPU.</div>
<div class="paranum"><a name="p14">14/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0171-1.TXT">AI05-0171-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0264-1.TXT">AI05-0264-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0281-1.TXT">AI12-0281-1</A></I>} 
<span class="insert5">For a task, the</span><span class="delete5">&nbsp;The</span> 
CPU value determines the processor on which the task will activate and 
execute; the task is said to be assigned to that processor. If the CPU 
value is Not_A_Specific_CPU, then the task is not assigned to a processor. 
A task without a CPU aspect specified will activate and execute on the 
same processor as its activating task if the activating task is assigned 
a processor. If the CPU value is not in the range of System.Multiprocessors.CPU_Range 
or is greater than Number_Of_CPUs the task is defined to have failed, 
and it becomes a completed task (see <A HREF="AA-9-2.html">9.2</A>).</div>
<div class="paranum"><a name="p15">15/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0281-1.TXT">AI12-0281-1</A></I>} 
<span class="insert5">For a protected type, the CPU value determines 
the processor on which calling tasks will execute; the protected object 
is said to be assigned to that processor. If the CPU value is Not_A_Specific_CPU, 
then the protected object is not assigned to a processor. A call to a 
protected object that is assigned to a processor from a task that is 
not assigned a processor or is assigned a different processor raises 
Program_Error.</span></div>
<div class="paranum"><a name="p15.a">15.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>Discussion:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0005-1.TXT">AI12-0005-1</A></I>} 
<span class="insert5">When a protected object is assigned to a CPU, only 
tasks also assigned to that CPU can call it. In contrast, a protected 
object that is not assigned to a specific CPU can be called by any task 
on any processor (subject, of course, to visibility and ceiling priority 
restrictions). As noted below, when the tasks and protected object are 
necessarily on the same CPU, a simpler implementation can be used.</span> 
</div>

<H4 Class="centered">Implementation Advice</H4>
<div class="paranum"><a name="p16">16/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0281-1.TXT">AI12-0281-1</A></I>} 
<span class="insert5"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0323-1.TXT">AI12-0323-1</A></I>} 
<span class="insert5">Starting a protected action on a protected object 
statically assigned to a processor should be implemented without busy-waiting.</span></div>
<div class="paranum"><a name="p16.a">16.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>Reason:&nbsp;</B>Busy-waiting 
is a form of lock and can be a source of deadlock. Busy-waiting is typically 
needed for starting protected actions on multiprocessors, but if all 
tasks calling a protected object execute on the same CPU, this locking 
isn't needed and the source of deadlock and associated overhead can be 
eliminated.</span>&nbsp;</div>
<div class="paranum"><a name="p16.b">16.b/5</a></div>
<div class="Annotations"><span class="insert5"><B>Implementation Advice: 
</B></span><span class="insert5">Starting a protected action on a protected 
object statically assigned to a processor should not use busy-waiting.</span></div>

<H4 Class="centered">Extensions to Ada 2005</H4>
<div class="paranum"><a name="p16.c">16.c/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0171-1.TXT">AI05-0171-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<A NAME="I10092"></A>The package System.Multiprocessors and the CPU aspect 
are new.&nbsp;</div>

<H4 Class="centered">Extensions to Ada 2012</H4>
<div class="paranum"><a name="p16.d">16.d/5</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0281-1.TXT">AI12-0281-1</A></I>} 
<span class="insert5"><A NAME="I10093"></A>Aspect CPU can now be applied 
to protected types, in order to avoid the overhead and deadlock potential 
of multiprocessor execution.</span>&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 2012</H4>
<div class="paranum"><a name="p16.e">16.e/4</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0081-1.TXT">AI12-0081-1</A></I>} 
<span class="insert4"><B>Corrigendum:</B> Clarified when the CPU aspect 
expression is evaluated.</span>&nbsp;</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-D-15.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-D-16-1.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
