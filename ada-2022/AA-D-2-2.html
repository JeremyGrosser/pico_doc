<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Task Dispatching Pragmas</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    SPAN.insert5 {text-decoration: underline; color: rgb(0,102,0) }
    SPAN.delete5 {text-decoration: line-through; color: rgb(0,102,0) }
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-bottom: 0.6em}
    DIV.Indented1 {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 4.3em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.8em; margin-bottom: 0.6em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,51,153)"><B>Annotated</B></SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)"><B>&nbsp;Ada Reference Manual</B> (Ada 2022 Draft 35)</SPAN> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-D-2-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-D-2-3.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>D.2.2 Task Dispatching Pragmas</H1>
<div class="paranum"><a name="p0.1">0.1/3</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0299-1.TXT">AI05-0299-1</A></I>} 
[This subclause allows a single task dispatching policy to be defined 
for all priorities, or the range of priorities to be split into subranges 
that are assigned individual dispatching policies.]&nbsp;</div>

<H4 Class="centered">Syntax</H4>
<div class="paranum"><a name="p1">1</a></div>
<div class="Indented1" style="margin-bottom: 0.4em">The form of a <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Task_Dispatching_Policy is as follows:&nbsp;</div>
<div class="paranum"><a name="p2">2</a></div>
<div class="Indented1">&nbsp;&nbsp;<B>pragma</B> <A NAME="I9730"></A><A NAME="I9731"></A>Task_Dispatching_Policy(<I>policy_</I><A NAME="I9732"></A><SPAN Class="swiss"><A HREF="AA-2-3.html#S0002">identifier</A></SPAN>);</div>
<div class="paranum"><a name="p2.1">2.1/2</a></div>
<div class="Indented1" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
The form of a <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Priority_Specific_Dispatching is as follows:&nbsp;</div>
<div class="paranum"><a name="p2.2">2.2/2</a></div>
<div class="Indented1">&nbsp;&nbsp;<B>pragma</B> <A NAME="I9733"></A><A NAME="I9734"></A>Priority_Specific_Dispatching 
(<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<I>policy_</I><A NAME="I9735"></A><SPAN Class="swiss"><A HREF="AA-2-3.html#S0002">identifier</A></SPAN>, 
<I>first_priority_</I><A NAME="I9736"></A><SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN>, 
<I>last_priority_</I><A NAME="I9737"></A><SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN>);</div>

<H4 Class="centered">Name Resolution Rules</H4>
<div class="paranum"><a name="p2.3">2.3/2</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
The expected type for <I>first_priority_</I><SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN> 
and <I>last_priority_</I><SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN> 
is Integer.&nbsp;</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum"><a name="p3">3/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00321.TXT">AI95-00321-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
The <I>policy_</I><SPAN Class="swiss"><A HREF="AA-2-3.html#S0002">identifier</A></SPAN> 
used in a <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Task_Dispatching_Policy shall be the name of a task dispatching policy. 
</div>
<div class="paranum"><a name="p3.a">3.a/2</a></div>
<div class="Annotations"><SPAN STYLE="font-size: 80%"><I>This paragraph 
was deleted.</I></SPAN></div>
<div class="paranum"><a name="p3.1">3.1/2</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
The <I>policy_</I><SPAN Class="swiss"><A HREF="AA-2-3.html#S0002">identifier</A></SPAN> 
used in a <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Priority_Specific_Dispatching shall be the name of a task dispatching 
policy.</div>
<div class="paranum"><a name="p3.2">3.2/2</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
Both <I>first_priority_</I><SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN> 
and <I>last_priority_</I><SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN> 
shall be static expressions in the range of System.Any_Priority; <I>last_priority_</I><SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN> 
shall have a value greater than or equal to <I>first_priority_</I><SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN>.</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum"><a name="p3.3">3.3/2</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">Pragma</A></SPAN> Task_Dispatching_Policy 
specifies the single task dispatching policy.</div>
<div class="paranum"><a name="p3.4">3.4/2</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">Pragma</A></SPAN> Priority_Specific_Dispatching 
specifies the task dispatching policy for the specified range of priorities. 
Tasks with base priorities within the range of priorities specified in 
a Priority_Specific_Dispatching pragma have their active priorities determined 
according to the specified dispatching policy. Tasks with active priorities 
within the range of priorities specified in a Priority_Specific_Dispatching 
pragma are dispatched according to the specified dispatching policy. 
</div>
<div class="paranum"><a name="p3.b">3.b/2</a></div>
<div class="Annotations"><B>Reason:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
Each ready queue is managed by exactly one policy. Anything else would 
be chaos. The ready queue is determined by the active priority. However, 
how the active priority is calculated is determined by the policy; in 
order to break out of this circle, we have to say that the active priority 
is calculated by the method determined by the policy of the base priority. 
</div>
<div class="paranum"><a name="p3.5">3.5/3</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0262-1.TXT">AI05-0262-1</A></I>} 
If a partition contains one or more Priority_Specific_Dispatching pragmas, 
the dispatching policy for priorities not covered by any Priority_Specific_Dispatching 
pragmas is FIFO_Within_Priorities.</div>

<H4 Class="centered">Post-Compilation Rules</H4>
<div class="paranum"><a name="p4">4/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<A NAME="I9738"></A><A NAME="I9739"></A>A Task_Dispatching_Policy pragma 
is a configuration pragma. A Priority_Specific_Dispatching pragma is 
a configuration pragma. <A NAME="I9740"></A><A NAME="I9741"></A></div>
<div class="paranum"><a name="p4.1">4.1/2</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
The priority ranges specified in more than one Priority_Specific_Dispatching 
pragma within the same partition shall not be overlapping.</div>
<div class="paranum"><a name="p4.2">4.2/2</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
If a partition contains one or more Priority_Specific_Dispatching pragmas 
it shall not contain a Task_Dispatching_Policy pragma.</div>
<div class="paranum"><a name="p5">5/2</a></div>
<div class="Normal"><SPAN STYLE="font-size: 80%"><I>This paragraph was 
deleted.</I></SPAN>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00333.TXT">AI95-00333-01</A></I>} 
</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum"><a name="p6">6/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<A NAME="I9742"></A>[A <I>task dispatching policy</I> specifies the details 
of task dispatching that are not covered by the basic task dispatching 
model. These rules govern when tasks are inserted into and deleted from 
the ready queues.] A single task dispatching policy is specified by a 
Task_Dispatching_Policy pragma. Pragma Priority_Specific_Dispatching 
assigns distinct dispatching policies to subranges of System.Any_Priority.</div>
<div class="paranum"><a name="p6.1">6.1/2</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<A NAME="I9743"></A>If neither <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
applies to any of the program units comprising a partition, the task 
dispatching policy for that partition is unspecified.</div>
<div class="paranum"><a name="p6.2">6.2/3</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0262-1.TXT">AI05-0262-1</A></I>} 
If a partition contains one or more Priority_Specific_Dispatching pragmas, 
a task dispatching point occurs for the currently running task of a processor 
whenever there is a nonempty ready queue for that processor with a higher 
priority than the priority of the running task.</div>
<div class="paranum"><a name="p6.a">6.a/3</a></div>
<div class="Annotations"><B>Discussion:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0005-1.TXT">AI05-0005-1</A></I>} 
If we have priority specific dispatching then we want preemption across 
the entire range of priorities. That prevents higher priority tasks from 
being blocked by lower priority tasks that have a different policy. On 
the other hand, if we have a single policy for the entire partition, 
we want the characteristics of that policy to apply for preemption; specifically, 
we might not require any preemption. Note that policy Non_Preemptive_FIFO_Within_Priorities 
is not allowed in a priority specific dispatching pragma.&nbsp;</div>
<div class="paranum"><a name="p6.3">6.3/2</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
A task that has its base priority changed may move from one dispatching 
policy to another. It is immediately subject to the new dispatching policy.</div>
<div class="paranum"><a name="p6.b">6.b/2</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>Once subject to the new 
dispatching policy, it may be immediately preempted or dispatched, according 
the rules of the new policy.&nbsp;</div>
<div class="Normal"><SPAN STYLE="font-size: 80%"><I>Paragraphs 7 through 
13 were moved to D.2.3.</I></SPAN>&nbsp;</div>

<H4 Class="centered">Implementation Requirements</H4>
<div class="paranum"><a name="p13.1">13.1/2</a></div>
<div class="Normal">&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00333.TXT">AI95-00333-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
An implementation shall allow, for a single partition, both the locking 
policy (see <A HREF="AA-D-3.html">D.3</A>) to be specified as Ceiling_Locking 
and also one or more Priority_Specific_Dispatching pragmas to be given. 
</div>

<H4 Class="centered">Documentation Requirements</H4>
<div class="Normal"><SPAN STYLE="font-size: 80%"><I>Paragraphs 14 through 
16 were moved to D.2.3.</I></SPAN>&nbsp;</div>
<div class="paranum"><a name="p16.a">16.a/2</a></div>
<div class="Annotations"><SPAN STYLE="font-size: 80%"><I>This paragraph 
was deleted.</I></SPAN></div>

<H4 Class="centered">Implementation Permissions</H4>
<div class="paranum"><a name="p17">17/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00256.TXT">AI95-00256-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0444-1.TXT">AI12-0444-1</A></I>} 
Implementations are allowed to define other task dispatching policies, 
but <span class="insert5">are not required to</span><span class="delete5">&nbsp;need 
not</span> support<span class="insert5">&nbsp;specifying</span> more than 
one task dispatching policy per partition.</div>
<div class="paranum"><a name="p18">18/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0444-1.TXT">AI12-0444-1</A></I>} 
An implementation <span class="insert5">is not required to</span><span class="delete5">&nbsp;need 
not</span> support <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Priority_Specific_Dispatching if it is infeasible to support it in the 
target environment.</div>
<div class="paranum"><a name="p18.a">18.a/2</a></div>
<div class="Annotations"><B>Implementation defined:&nbsp;</B>Implementation 
defined task dispatching policies.</div>
<div class="Notes"><SPAN STYLE="font-size: 80%"><I>Paragraphs 19 through 
21 were deleted.</I></SPAN>&nbsp;</div>

<H4 Class="centered">Extensions to Ada 95</H4>
<div class="paranum"><a name="p21.a">21.a/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00333.TXT">AI95-00333-01</A></I>} 
<A NAME="I9744"></A><B>Amendment Correction:</B> It is no longer required 
to specify Ceiling_Locking with the language-defined task dispatching 
policies; we only require that implementations <I>allow</I> them to be 
used together.</div>
<div class="paranum"><a name="p21.b">21.b/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0005-1.TXT">AI05-0005-1</A></I>} 
<B>Pragma</B> Priority_Specific_Dispatching is new; it allows the specification 
of different policies for different priorities.&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 95</H4>
<div class="paranum"><a name="p21.c">21.c/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00256.TXT">AI95-00256-01</A></I>} 
Clarified that an implementation need support only one task dispatching 
policy (of any kind, language-defined or otherwise) per partition.</div>
<div class="paranum"><a name="p21.d">21.d/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00321.TXT">AI95-00321-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0005-1.TXT">AI05-0005-1</A></I>} 
This description is simplified to describe only the rules for the Task_Dispatching_Policy 
pragma that are common to all policies. In particular, rules about preemption 
are moved elsewhere. This makes it easier to add other policies (which 
might not involve preemption).&nbsp;</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-D-2-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-D-2-3.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
