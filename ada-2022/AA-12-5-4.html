<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Formal Access Types</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-bottom: 0.6em}
    DIV.Indented1 {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.8em; margin-bottom: 0.6em}
    DIV.Examples {font-family: "Courier New", monospace; font-size: 90%; line-height: 122%; margin-left: 4.0em; margin-bottom: 0.6em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,51,153)"><B>Annotated</B></SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)"><B>&nbsp;Ada Reference Manual</B> (Ada 2022 Draft 35)</SPAN> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-12-5-3.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-12-5-5.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>12.5.4 Formal Access Types</H1>
<div class="paranum"><a name="p1">1/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00442.TXT">AI95-00442-01</A></I>} 
[The category determined for a formal access type is the category of 
all access types.]&nbsp;</div>
<div class="paranum"><a name="p1.a">1.a/2</a></div>
<div class="Annotations"><B>Proof:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00442.TXT">AI95-00442-01</A></I>} 
This rule follows from the rule in <A HREF="AA-12-5.html">12.5</A> that 
says that the category is determined by the one given in the name of 
the syntax production. The effect of the rule is repeated here to give 
a capsule summary of what this subclause is about.&nbsp;</div>

<H4 Class="centered">Syntax</H4>
<div class="paranum"><a name="p2">2</a></div>
<div class="Indented1"><SPAN Class="swiss">formal_access_type_definition</SPAN><A NAME="I5986"></A><A NAME="S0333"></A><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN><A NAME="I5987"></A><SPAN Class="swiss"><A HREF="AA-3-10.html#S0079">access_type_definition</A></SPAN></div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum"><a name="p3">3</a></div>
<div class="Normal">For a formal access-to-object type, the designated 
subtypes of the formal and actual types shall statically match. <A NAME="I5988"></A></div>
<div class="paranum"><a name="p4">4/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00231.TXT">AI95-00231-01</A></I>} 
If and only if the <SPAN Class="swiss"><A HREF="AA-3-10.html#S0081">general_access_modifier</A></SPAN> 
<B>constant</B> applies to the formal, the actual shall be an access-to-constant 
type. If the <SPAN Class="swiss"><A HREF="AA-3-10.html#S0081">general_access_modifier</A></SPAN> 
<B>all</B> applies to the formal, then the actual shall be a general 
access-to-variable type (see <A HREF="AA-3-10.html">3.10</A>). If and 
only if the formal subtype excludes null, the actual subtype shall exclude 
null.&nbsp;</div>
<div class="paranum"><a name="p4.a">4.a</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>If no <SPAN Class="swiss">_modifier</SPAN> 
applies to the formal, then the actual type may be either a pool-specific 
or a general access-to-variable type.&nbsp;</div>
<div class="paranum"><a name="p4.a.1">4.a.1/1</a></div>
<div class="Annotations"><B>Reason:&nbsp;</B>{<I><A HREF="defect2.html#8652/0109">8652/0109</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00025.TXT">AI95-00025-01</A></I>} 
Matching an access-to-variable to a formal access-to-constant type cannot 
be allowed. If it were allowed, it would be possible to create an access-to-variable 
value designating a constant.</div>
<div class="paranum"><a name="p4.b">4.b/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00231.TXT">AI95-00231-01</A></I>} 
We require that the &ldquo;excludes null&rdquo; property match, because 
it would be difficult to write a correct generic for a formal access 
type without knowing this property. Many typical algorithms and techniques 
will not work for a subtype that excludes null (setting an unused component 
to <B>null</B>, default-initialized objects, and so on). Even Ada.Unchecked_Deallocation 
would fail for a subtype that excludes null. Most generics would end 
up with comments saying that they are not intended to work for subtypes 
that exclude null. We would rather that this sort of requirement be reflected 
in the contract of the generic.&nbsp;</div>
<div class="paranum"><a name="p5">5/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0239-1.TXT">AI05-0239-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0288-1.TXT">AI05-0288-1</A></I>} 
For a formal access-to-subprogram subtype, the designated profiles of 
the formal and the actual shall be subtype conformant. <A NAME="I5989"></A></div>

<H4 Class="centered">Examples</H4>
<div class="paranum"><a name="p6">6</a></div>
<div class="Normal" style="margin-bottom: 0.4em"><I>Example of formal 
access types:</I>&nbsp;</div>
<div class="paranum"><a name="p7">7</a></div>
<div class="Examples">--<SPAN Class="roman"><I>&nbsp;&nbsp;the&nbsp;formal&nbsp;types&nbsp;of&nbsp;the&nbsp;generic&nbsp;package&nbsp;</I></SPAN></div>
<div class="paranum"><a name="p8">8</a></div>
<div class="Examples"><B>generic</B><BR>
&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;Node&nbsp;<B>is</B>&nbsp;<B>private</B>;<BR>
&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;Link&nbsp;<B>is</B>&nbsp;<B>access</B>&nbsp;Node;<BR>
<B>package</B>&nbsp;P&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;...<BR>
<B>end</B>&nbsp;P;</div>
<div class="paranum"><a name="p9">9</a></div>
<div class="Examples">--<SPAN Class="roman"><I>&nbsp;&nbsp;can&nbsp;be&nbsp;matched&nbsp;by&nbsp;the&nbsp;actual&nbsp;types&nbsp;</I></SPAN></div>
<div class="paranum"><a name="p10">10</a></div>
<div class="Examples"><B>type</B>&nbsp;Car;<BR>
<B>type</B>&nbsp;Car_Name&nbsp;<B>is</B>&nbsp;<B>access</B>&nbsp;Car;</div>
<div class="paranum"><a name="p11">11</a></div>
<div class="Examples"><B>type</B>&nbsp;Car&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;<B>record</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pred,&nbsp;Succ&nbsp;:&nbsp;Car_Name;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Number&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;License_Number;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Owner&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;Person;<BR>
&nbsp;&nbsp;&nbsp;<B>end</B>&nbsp;<B>record</B>;</div>
<div class="paranum"><a name="p12">12</a></div>
<div class="Examples">--<SPAN Class="roman"><I>&nbsp;&nbsp;in&nbsp;the&nbsp;following&nbsp;generic&nbsp;instantiation&nbsp;</I></SPAN></div>
<div class="paranum"><a name="p13">13</a></div>
<div class="Examples"><B>package</B>&nbsp;R&nbsp;<B>is</B>&nbsp;<B>new</B>&nbsp;P(Node&nbsp;=&gt;&nbsp;Car,&nbsp;Link&nbsp;=&gt;&nbsp;Car_Name);</div>

<H4 Class="centered">Incompatibilities With Ada 83</H4>
<div class="paranum"><a name="p13.a">13.a</a></div>
<div class="Annotations"><A NAME="I5990"></A>The check for matching of 
designated subtypes is changed from a runtime check to a compile-time 
check. The Ada 83 rule that &ldquo;If the designated type is other than 
a scalar type, then the designated subtypes shall be either both constrained 
or both unconstrained&rdquo; is removed, since it is subsumed by static 
matching.&nbsp;</div>

<H4 Class="centered">Extensions to Ada 83</H4>
<div class="paranum"><a name="p13.b">13.b</a></div>
<div class="Annotations"><A NAME="I5991"></A>Formal access-to-subprogram 
subtypes and formal general access types are new concepts.&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 95</H4>
<div class="paranum"><a name="p13.c">13.c/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00231.TXT">AI95-00231-01</A></I>} 
Added a matching rule for subtypes that exclude null.</div>
<div class="paranum"><a name="p13.d">13.d/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00442.TXT">AI95-00442-01</A></I>} 
We change to &ldquo;determines a category&rdquo; as that is the new terminology 
(it avoids confusion, since not all interesting properties form a class). 
</div>

<H4 Class="centered">Incompatibilities With Ada 2005</H4>
<div class="paranum"><a name="p13.e">13.e/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0288-1.TXT">AI05-0288-1</A></I>} 
<A NAME="I5992"></A><B>Correction:</B> Matching of formal access-to-subprogram 
types now uses subtype conformance rather than mode conformance, which 
is needed to plug a hole. This could cause some instantiations legal 
in Ada 95 and Ada 2005 to be rejected in Ada 2012. We believe that formal 
access-to-subprogram types occur rarely, and actuals that are not subtype 
conformant are rarer still, so this should not happen often. (In addition, 
one popular compiler has a bug that causes such instances to be rejected, 
so no code compiled with that compiler could have an incompatibility.) 
</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-12-5-3.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-12-5-5.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
