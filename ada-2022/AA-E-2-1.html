<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Shared Passive Library Units</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    SPAN.insert4 {text-decoration: underline; color: rgb(153,0,0) }
    SPAN.delete4 {text-decoration: line-through; color: rgb(153,0,0) }
    SPAN.insert5 {text-decoration: underline; color: rgb(0,102,0) }
    SPAN.delete5 {text-decoration: line-through; color: rgb(0,102,0) }
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-bottom: 0.6em}
    DIV.Indented1 {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.8em; margin-bottom: 0.6em}
    DIV.Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.Indented2Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.8em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Indented2Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.8em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,51,153)"><B>Annotated</B></SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)"><B>&nbsp;Ada Reference Manual</B> (Ada 2022 Draft 35)</SPAN> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-E-2.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-E-2-2.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>E.2.1 Shared Passive Library Units</H1>
<div class="paranum"><a name="p1">1</a></div>
<div class="Normal">[A shared passive library unit is used for managing 
global data shared between active partitions. The restrictions on shared 
passive library units prevent the data or tasks of one active partition 
from being accessible to another active partition through references 
implicit in objects declared in the shared passive library unit.]&nbsp;</div>

<H4 Class="centered">Language Design Principles</H4>
<div class="paranum"><a name="p1.a">1.a</a></div>
<div class="Annotations">The restrictions governing a shared passive 
library unit are designed to ensure that objects and subprograms declared 
in the package can be used safely from multiple active partitions, even 
though the active partitions live in different address spaces, and have 
separate run-time systems.&nbsp;</div>

<H4 Class="centered">Syntax</H4>
<div class="paranum"><a name="p2">2/5</a></div>
<div class="Indented1" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0417-1.TXT">AI12-0417-1</A></I>} 
<span class="delete5"><A NAME="I10142"></A><A NAME="I10143"></A>The form 
of a <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Shared_Passive is as follows:</span>&nbsp;</div>
<div class="paranum"><a name="p3">3/5</a></div>
<div class="Indented1">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0417-1.TXT">AI12-0417-1</A></I>} 
&nbsp;&nbsp;<span class="delete5"><B>pragma</B> <A NAME="I10144"></A><A NAME="I10145"></A>Shared_Passive[(<I>library_unit_</I><A NAME="I10146"></A><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN>)];</span></div>
<div class="Normal"><span class="insert5"><SPAN STYLE="font-size: 80%"><I>Paragraphs 
2 and 3 were moved to <A HREF="AA-J.html">Annex J</A>, &ldquo;<A HREF="AA-J.html">Obsolescent 
Features</A>&rdquo;.</I></SPAN></span>&nbsp;</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum"><a name="p4">4/5</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0243-1.TXT">AI05-0243-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0417-1.TXT">AI12-0417-1</A></I>} 
<A NAME="I10147"></A><span class="insert5">When the library unit aspect 
(see <A HREF="AA-13-1-1.html">13.1.1</A>)</span><span class="delete5">&nbsp;A</span><span class="delete5">&nbsp;<SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN></span> 
Shared_Passive<span class="insert5"><A NAME="I10148"></A><A NAME="I10149"></A> 
of</span><span class="delete5">&nbsp;is used to specify that</span> a library 
unit is <span class="insert5">True, the library unit is a</span><span class="delete5">&nbsp;a</span> 
<I>shared passive library unit</I><span class="delete5">, namely that 
the Shared_Passive aspect<A NAME="I10150"></A><A NAME="I10151"></A> of 
the library unit is True</span>. The following restrictions apply to 
such a library unit:</div>
<div class="paranum"><a name="p4.a">4.a/3</a></div>
<div class="Annotations"><B>Aspect Description for&nbsp;</B><B>Shared_Passive: 
</B>A given package is used to represent shared memory in a distributed 
system.</div>
<div class="paranum"><a name="p5">5</a></div>
<div class="Bulleted">[it shall be preelaborable (see <A HREF="AA-10-2-1.html">10.2.1</A>);] 
</div>
<div class="paranum"><a name="p5.a">5.a</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>It cannot contain library-level 
declarations of protected objects with entries, nor of task objects. 
Task objects are disallowed because passive partitions don't have any 
threads of control of their own, nor any run-time system of their own. 
Protected objects with entries are disallowed because an entry queue 
contains references to calling tasks, and that would require in effect 
a pointer from a passive partition back to a task in some active partition. 
</div>
<div class="paranum"><a name="p6">6/3</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0243-1.TXT">AI05-0243-1</A></I>} 
it shall depend semantically only upon declared pure or shared passive 
<SPAN Class="swiss"><A HREF="AA-10-1-1.html#S0287">library_item</A></SPAN>s; 
</div>
<div class="paranum"><a name="p6.a">6.a</a></div>
<div class="Annotations"><B>Reason:&nbsp;</B>Shared passive packages cannot 
depend semantically upon remote types packages because the values of 
an access type declared in a remote types package refer to the local 
heap of the active partition including the remote types package.&nbsp;</div>
<div class="paranum"><a name="p6.b">6.b/3</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0243-1.TXT">AI05-0243-1</A></I>} 
We say <SPAN Class="swiss"><A HREF="AA-10-1-1.html#S0287">library_item</A></SPAN> 
here, so that limited views are allowed; those are not library units, 
but they are <SPAN Class="swiss"><A HREF="AA-10-1-1.html#S0287">library_item</A></SPAN>. 
</div>
<div class="paranum"><a name="p7">7/5</a></div>
<div class="Bulleted" style="margin-bottom: 0.3em">{<I><A HREF="defect1.html#8652/0080">8652/0080</A></I>} 
<span class="insert5"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00003.TXT">AI95-00003-01</A></I>} 
<span class="insert5"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0038-1.TXT">AI12-0038-1</A></I>} 
<span class="insert5"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0320-1.TXT">AI12-0320-1</A></I>} 
<span class="insert5"></span>it shall not contain a library-level declaration<span class="insert5">:</span><span class="delete5">&nbsp;of an access type that designates a class-wide type,</span><span class="insert4"><span class="delete5">&nbsp;nor a type with a part that is of a</span></span><span class="delete5">&nbsp;task type</span><span class="delete4">,</span><span class="delete5">&nbsp;or protected type with <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0257">entry_declaration</A></SPAN>s</span><span class="insert4"><span class="delete5">;</span></span><span class="delete5"></span><span class="delete4">.</span><span class="delete5"></span></div>
<div class="paranum"><a name="p7.1">7.1/5</a></div>
<div class="Indented2Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0320-1.TXT">AI12-0320-1</A></I>} 
<span class="insert5">of an access type that designates a class-wide 
type;</span>&nbsp;</div>
<div class="paranum"><a name="p7.a">7.a</a></div>
<div class="Annotations"><B>Reason:&nbsp;</B>These kinds of access types are 
disallowed because the object designated by an access value of such a 
type could contain an implicit reference back to the active partition 
on whose behalf the designated object was created.&nbsp;</div>
<div class="paranum"><a name="p7.2">7.2/5</a></div>
<div class="Indented2Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0320-1.TXT">AI12-0320-1</A></I>} 
<span class="insert5">of a type with a part that is of a task type;</span></div>
<div class="paranum"><a name="p7.3">7.3/5</a></div>
<div class="Indented2Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0320-1.TXT">AI12-0320-1</A></I>} 
<span class="insert5">of a type with a part that is of a protected type 
with <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0257">entry_declaration</A></SPAN>s; 
or</span></div>
<div class="paranum"><a name="p7.4">7.4/5</a></div>
<div class="Indented2Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0038-1.TXT">AI12-0038-1</A></I>} 
<span class="insert4"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0320-1.TXT">AI12-0320-1</A></I>} 
<span class="insert4"></span><span class="insert4"><span class="delete5">it 
shall not contain a library-level declaration&nbsp;</span></span><span class="insert4">that 
contains a name that denotes a type declared within a declared-pure package, 
if that type has a part that is of an access type; for the purposes of 
this rule, the parts considered include those of the full views of any 
private types or private extensions.</span></div>
<div class="paranum"><a name="p7.b">7.b/4</a></div>
<div class="Annotations"><span class="insert4"><B>Reason:&nbsp;</B>This rule 
breaks privacy by looking into the full views of private types. Avoiding 
privacy breakage here would have required disallowing the use in a shared 
passive package of any private type declared in a declared-pure package, 
which would have been severely incompatible.</span>&nbsp;</div>
<div class="paranum"><a name="p8">8</a></div>
<div class="Normal"><A NAME="I10152"></A><A NAME="I10153"></A>Notwithstanding 
the definition of accessibility given in <A HREF="AA-3-10-2.html">3.10.2</A>, 
the declaration of a library unit P1 is not accessible from within the 
declarative region of a shared passive library unit P2, unless the shared 
passive library unit P2 depends semantically on P1.&nbsp;</div>
<div class="paranum"><a name="p8.a">8.a</a></div>
<div class="Annotations"><B>Discussion:&nbsp;</B>We considered a more complex 
rule, but dropped it. This is the simplest rule that recognizes that 
a shared passive package may outlive some other library package, unless 
it depends semantically on that package. In a nondistributed program, 
all library packages are presumed to have the same lifetime.</div>
<div class="paranum"><a name="p8.b">8.b/5</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0417-1.TXT">AI12-0417-1</A></I>} 
Implementations may define additional <span class="insert5">aspects or 
</span>pragmas that force two library packages to be in the same partition, 
or to have the same lifetime, which would allow this rule to be relaxed 
in the presence of such <span class="insert5">aspects or&nbsp;</span>pragmas. 
</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum"><a name="p9">9</a></div>
<div class="Normal"><A NAME="I10154"></A>A shared passive library unit 
is preelaborated.</div>

<H4 Class="centered">Post-Compilation Rules</H4>
<div class="paranum"><a name="p10">10</a></div>
<div class="Normal">A shared passive library unit shall be assigned to 
at most one partition within a given program.</div>
<div class="paranum"><a name="p11">11</a></div>
<div class="Normal"><A NAME="I10155"></A><A NAME="I10156"></A><A NAME="I10157"></A>Notwithstanding 
the rule given in <A HREF="AA-10-2.html">10.2</A>, a compilation unit 
in a given partition does not <I>need</I> (in the sense of <A HREF="AA-10-2.html">10.2</A>) 
the shared passive library units on which it depends semantically to 
be included in that same partition; they will typically reside in separate 
passive partitions.</div>
<div class="paranum"><a name="p11.a">11.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>To be honest:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0359-1.TXT">AI12-0359-1</A></I>} 
<span class="insert5">This rule is necessary so that the shared data 
of a shared passive partition is not duplicated in each partition. It 
does not imply a particular implementation; in particular, code can be 
replicated in each active partition.</span>&nbsp;</div>
<div class="paranum"><a name="p11.b">11.b/5</a></div>
<div class="Annotations"><span class="insert5"><B>Implementation Note: 
</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0359-1.TXT">AI12-0359-1</A></I>} 
<span class="insert5">One possible implementation for a shared passive 
partition is as a shared library that is mapped into the address space 
of of each active partition. In such case, both the code and the data 
of the passive partition would be mapped into the active partitions and 
directly called/accessed from each active partition. For instance, on 
Microsoft Windows a DLL has the correct semantics.</span></div>
<div class="paranum"><a name="p11.c">11.c/5</a></div>
<div class="Annotations"><span class="insert5">Alternatively, the shared 
data can be represented as a file or persistent memory, with the shared 
code being replicated in each active partition. Code replication is an 
as-if optimization; it should be impossible to tell where the code lives 
since no elaboration is necessary.</span>&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 95</H4>
<div class="paranum"><a name="p11.d">11.d/2</a></div>
<div class="Annotations">{<I><A HREF="defect1.html#8652/0080">8652/0080</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00003.TXT">AI95-00003-01</A></I>} 
<B>Corrigendum:</B> Corrected the wording to allow access types in blocks 
in shared passive generic packages.&nbsp;</div>

<H4 Class="centered">Extensions to Ada 2005</H4>
<div class="paranum"><a name="p11.e">11.e/5</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0243-1.TXT">AI05-0243-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0417-1.TXT">AI12-0417-1</A></I>} 
<A NAME="I10158"></A>Shared_Passive is now a categorization aspect, so 
it can be specified by an <SPAN Class="swiss"><A HREF="AA-13-1-1.html#S0346">aspect_specification</A></SPAN><span class="delete5">&nbsp;&mdash; although the pragma is still preferred by the Reference Manual.</span> 
</div>

<H4 Class="centered">Incompatibilities With Ada 2012</H4>
<div class="paranum"><a name="p11.f">11.f/4</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0038-1.TXT">AI12-0038-1</A></I>} 
<span class="insert4"><A NAME="I10159"></A><B>Corrigendum:</B> Uses of 
access types declared in declared-pure units are not allowed in library-level 
shared passive packages. These were allowed by Ada 2005 and Ada 2012, 
but it is unlikely that they work properly, as active partitions could 
disappear before the shared-passive partition. As such, the new errors 
are more likely to catch bugs than to cause them.</span>&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 2012</H4>
<div class="paranum"><a name="p11.g">11.g/5</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0417-1.TXT">AI12-0417-1</A></I>} 
<span class="insert5">The pragma Shared_Passive is now obsolescent.</span> 
</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-E-2.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-E-2-2.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
