<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Conflict Check Policies</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    SPAN.insert5 {text-decoration: underline; color: rgb(0,102,0) }
    SPAN.delete5 {text-decoration: line-through; color: rgb(0,102,0) }
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-bottom: 0.6em}
    DIV.Indented1 {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.8em; margin-bottom: 0.6em}
    DIV.Indented4Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 9.8em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Indented4Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 9.8em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.WideHanging-Body {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 7.8em; margin-top: 0em; margin-bottom: 0.6em}
    DIV.WideHanging-Term {float: left; font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-top: 0em; margin-bottom: 0em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,51,153)"><B>Annotated</B></SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)"><B>&nbsp;Ada Reference Manual</B> (Ada 2022 Draft 35)</SPAN> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-9-10.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-9-11.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>9.10.1 <span class="insert5">Conflict Check Policies</span><span class="delete5"></span></H1>
<div class="paranum"><a name="p1">1/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0267-1.TXT">AI12-0267-1</A></I>} 
<span class="insert5">This subclause determines what checks are performed 
relating to possible concurrent conflicting actions (see <A HREF="AA-9-10.html">9.10</A>).<A NAME="I5347"></A></span> 
</div>

<H4 Class="centered">Syntax</H4>
<div class="paranum"><a name="p2">2/5</a></div>
<div class="Indented1" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0267-1.TXT">AI12-0267-1</A></I>} 
<span class="insert5"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0298-1.TXT">AI12-0298-1</A></I>} 
<span class="insert5">The form of a <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Conflict_Check_Policy is as follows:</span></div>
<div class="paranum"><a name="p3">3/5</a></div>
<div class="Indented1">&nbsp;&nbsp;<span class="insert5"><B>pragma</B> 
<A NAME="I5348"></A><A NAME="I5349"></A>Conflict_Check_Policy (<I>policy_</I><A NAME="I5350"></A><SPAN Class="swiss"><A HREF="AA-2-3.html#S0002">identifier</A></SPAN>[, 
<I>policy_</I><A NAME="I5351"></A><SPAN Class="swiss"><A HREF="AA-2-3.html#S0002">identifier</A></SPAN>]);</span></div>
<div class="paranum"><a name="p4">4/5</a></div>
<div class="Indented1">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0267-1.TXT">AI12-0267-1</A></I>} 
<span class="insert5">A <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Conflict_Check_Policy is allowed only immediately within a <SPAN Class="swiss"><A HREF="AA-3-11.html#S0086">declarative_part</A></SPAN>, 
a <SPAN Class="swiss"><A HREF="AA-7-1.html#S0230">package_specification</A></SPAN>, 
or as a configuration pragma.</span></div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum"><a name="p5">5/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0267-1.TXT">AI12-0267-1</A></I>} 
<span class="insert5">Each <I>policy_</I><SPAN Class="swiss"><A HREF="AA-2-3.html#S0002">identifier</A></SPAN> 
shall be one of No_Parallel_Conflict_Checks, Known_Parallel_Conflict_Checks, 
All_Parallel_Conflict_Checks, No_Tasking_Conflict_Checks, Known_Tasking_Conflict_Checks, 
All_Tasking_Conflict_Checks, No_Conflict_Checks, Known_Conflict_Checks, 
All_Conflict_Checks, or an implementation-defined conflict check policy. 
If two <I>policy_</I><SPAN Class="swiss"><A HREF="AA-2-3.html#S0002">identifier</A></SPAN>s 
are given, one shall include the word Parallel and one shall include 
the word Tasking. If only one <I>policy_</I><SPAN Class="swiss"><A HREF="AA-2-3.html#S0002">identifier</A></SPAN> 
is given, it shall not include the word Parallel or Tasking.</span></div>
<div class="paranum"><a name="p5.a.1">5.a.1/5</a></div>
<div class="Annotations"><span class="insert5"><B>Implementation defined: 
</B></span><span class="insert5">Implementation-defined conflict check 
policies.</span></div>
<div class="paranum"><a name="p6">6/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0267-1.TXT">AI12-0267-1</A></I>} 
<span class="insert5">A <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Conflict_Check_Policy given in a <SPAN Class="swiss"><A HREF="AA-3-11.html#S0086">declarative_part</A></SPAN> 
or immediately within a <SPAN Class="swiss"><A HREF="AA-7-1.html#S0230">package_specification</A></SPAN> 
applies from the place of the pragma to the end of the innermost enclosing 
declarative region. The region for a <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Conflict_Check_Policy given as a configuration pragma is the declarative 
region for the entire compilation unit (or units) to which it applies.</span></div>
<div class="paranum"><a name="p7">7/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0267-1.TXT">AI12-0267-1</A></I>} 
<span class="insert5">If a <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Conflict_Check_Policy applies to a <SPAN Class="swiss"><A HREF="AA-12-3.html#S0315">generic_instantiation</A></SPAN>, 
then the <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Conflict_Check_Policy applies to the entire instance.</span></div>
<div class="paranum"><a name="p8">8/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0267-1.TXT">AI12-0267-1</A></I>} 
<span class="insert5"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0294-1.TXT">AI12-0294-1</A></I>} 
<span class="insert5"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0298-1.TXT">AI12-0298-1</A></I>} 
<span class="insert5">If multiple Conflict_Check_Policy pragmas apply 
to a given construct, the conflict check policy is determined by the 
one in the innermost enclosing region. If no Conflict_Check_Policy pragma 
applies to a construct, the policy is (All_Parallel_Conflict_Checks, 
No_Tasking_Conflict_Checks) (see below).</span></div>
<div class="paranum"><a name="p8.a">8.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>To be honest:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0294-1.TXT">AI12-0294-1</A></I>} 
<span class="insert5">The region mentioned in this rule is the region 
to which the policy pragma applies, and not the declarative region in 
which the policy pragma appears. This distinction matters when there 
are multiple policy pragmas in a single declarative region.</span>&nbsp;</div>
<div class="paranum"><a name="p9">9/5</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0267-1.TXT">AI12-0267-1</A></I>} 
<span class="insert5"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0298-1.TXT">AI12-0298-1</A></I>} 
<span class="insert5">Certain potentially conflicting actions are disallowed 
according to which conflict check policies apply at the place where the 
action or actions occur, as follows:</span></div>
<div class="paranum"><a name="p10">10/5</a></div>
<div class="WideHanging-Term"><span class="insert5">No_Parallel_Conflict_Checks</span></div><div class="WideHanging-Body"><br clear="left">
<span class="insert5">This policy imposes no restrictions on concurrent 
actions arising from <A NAME="I5352"></A>parallel constructs.</span></div>
<div class="paranum"><a name="p11">11/5</a></div>
<div class="WideHanging-Term"><span class="insert5">No_Tasking_Conflict_Checks</span></div><div class="WideHanging-Body"><br clear="left">
<span class="insert5">This policy imposes no restrictions on concurrent 
actions arising from tasking <A NAME="I5353"></A>constructs.</span></div>
<div class="paranum"><a name="p12">12/5</a></div>
<div class="WideHanging-Term" style="margin-bottom: 0.4em"><span class="insert5">Known_Parallel_Conflict_Checks</span></div><div class="WideHanging-Body"><br clear="left">
<span class="insert5">If this policy applies to two concurrent actions 
appearing within parallel constructs, <A NAME="I5354"></A>they are disallowed 
if they are known to denote the same object (see <A HREF="AA-6-4-1.html">6.4.1</A>) 
with uses that conflict. For the purposes of this check, any parallel 
loop may be presumed to involve multiple concurrent iterations. Also, 
for the purposes of deciding whether two actions are concurrent, it is 
enough for the logical threads of control in which they occur to be concurrent 
at any point in their execution, unless all of the following are true:</span></div>
<div class="paranum"><a name="p13">13/5</a></div>
<div class="Indented4Bulleted"><span class="insert5">the shared object 
is volatile;</span></div>
<div class="paranum"><a name="p14">14/5</a></div>
<div class="Indented4Bulleted"><span class="insert5">the two logical 
threads of control are both known to also refer to a shared synchronized 
object; and</span></div>
<div class="paranum"><a name="p15">15/5</a></div>
<div class="Indented4Bulleted"><span class="insert5">each thread whose 
potentially conflicting action updates the shared volatile object, also 
updates this shared synchronized object.</span></div>
<div class="paranum"><a name="p15.a">15.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>Reason:&nbsp;</B>To properly 
synchronize two actions to prevent concurrency, a thread that does an 
update of a volatile object must update a synchronized object afterwards 
to indicate it has completed its update, and the other thread needs to 
test the value of the synchronized object before it reads the updated 
volatile object. In a parallel construct, &ldquo;signaling&rdquo; cannot 
be used to prevent concurrency, since that generally requires some blocking, 
so testing the value of the synchronized object would probably need to 
use a busy-wait loop.</span>&nbsp;</div>
<div class="paranum"><a name="p16">16/5</a></div>
<div class="WideHanging-Term" style="margin-bottom: 0.4em"><span class="insert5">Known_Tasking_Conflict_Checks</span></div><div class="WideHanging-Body"><br clear="left">
<span class="insert5">If this policy applies to two concurrent actions 
appearing within <A NAME="I5355"></A>the same compilation unit, at least 
one of which appears within a task body but not within a parallel construct, 
they are disallowed if they are known to denote the same object (see 
<A HREF="AA-6-4-1.html">6.4.1</A>) with uses that conflict, and neither 
potentially signals the other (see <A HREF="AA-9-10.html">9.10</A>). 
For the purposes of this check, any named task type may be presumed to 
have multiple instances. Also, for the purposes of deciding whether two 
actions are concurrent, it is enough for the tasks in which they occur 
to be concurrent at any point in their execution, unless all of the following 
are true:</span></div>
<div class="paranum"><a name="p17">17/5</a></div>
<div class="Indented4Bulleted"><span class="insert5">the shared object 
is volatile;</span></div>
<div class="paranum"><a name="p18">18/5</a></div>
<div class="Indented4Bulleted"><span class="insert5">the two tasks are 
both known to also refer to a shared synchronized object; and</span></div>
<div class="paranum"><a name="p19">19/5</a></div>
<div class="Indented4Bulleted"><span class="insert5">each task whose 
potentially conflicting action updates the shared volatile object, also 
updates this shared synchronized object.</span></div>
<div class="paranum"><a name="p19.a">19.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>Reason:&nbsp;</B>To properly 
synchronize two actions to prevent concurrency, a task that does an update 
of a <I>non</I>volatile object must use signaling via a synchronized 
object to indicate it has completed its update, and the other task needs 
to be signaled by this action on the synchronized object before it reads 
the updated nonvolatile object. In other words, to synchronize communication 
via a nonvolatile object, signaling must be used. To synchronize communication 
via a volatile object, an update of a shared synchronized object followed 
by a read of the synchronized object in the other task can be sufficient.</span> 
</div>
<div class="paranum"><a name="p20">20/5</a></div>
<div class="WideHanging-Term"><span class="insert5">All_Parallel_Conflict_Checks</span></div><div class="WideHanging-Body"><br clear="left">
<span class="insert5">This policy includes the restrictions imposed by 
the Known_Parallel_Conflict_Checks policy, and in <A NAME="I5356"></A>addition 
disallows a parallel construct from reading or updating a variable that 
is global to the construct, unless it is a synchronized object, or unless 
the construct is a parallel loop, and the global variable is a part of 
a component of an array denoted by an indexed component with at least 
one index expression that statically denotes the loop parameter of the 
<SPAN Class="swiss"><A HREF="AA-5-5.html#S0181">loop_parameter_specification</A></SPAN> 
or the chunk parameter of the parallel loop.</span></div>
<div class="paranum"><a name="p21">21/5</a></div>
<div class="WideHanging-Term"><span class="insert5">All_Tasking_Conflict_Checks</span></div><div class="WideHanging-Body"><br clear="left">
<span class="insert5">This policy includes <A NAME="I5357"></A>the restrictions 
imposed by the Known_Tasking_Conflict_Checks policy, and in addition 
disallows a task body from reading or updating a variable that is global 
to the task body, unless it is a synchronized object.</span></div>
<div class="paranum"><a name="p22">22/5</a></div>
<div class="WideHanging-Term"><span class="insert5">No_Conflict_Checks, 
Known_Conflict_Checks, All_Conflict_Checks</span></div><div class="WideHanging-Body"><br clear="left">
<span class="insert5">These are shorthands for (No_Parallel_Conflict_Checks, 
<A NAME="I5358"></A>No_Tasking_Conflict_Checks), (Known_Parallel_Conflict_Checks, 
<A NAME="I5359"></A>Known_Tasking_Conflict_Checks), and (All_Parallel_Conflict_Checks, 
<A NAME="I5360"></A>All_Tasking_Conflict_Checks), respectively.</span></div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum"><a name="p23">23/5</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0344-1.TXT">AI12-0344-1</A></I>} 
<span class="insert5">For a subprogram, the following language-defined 
representation aspect may be specified:</span></div>
<div class="paranum"><a name="p24">24/5</a></div>
<div class="WideHanging-Term"><span class="insert5">Parallel_Calls</span></div><div class="WideHanging-Body"><br clear="left">
<span class="insert5">The Parallel_Calls aspect is of type Boolean. The 
specified value shall be static. The Parallel_Calls aspect<A NAME="I5361"></A><A NAME="I5362"></A> 
of an inherited primitive subprogram is True if Parallel_Calls is True 
either for the corresponding subprogram of the progenitor type or for 
any other inherited subprogram that it overrides. If not specified or 
inherited as True, the Parallel_Calls aspect of a subprogram is False.</span></div>
<div class="paranum"><a name="p25">25/5</a></div>
<div class="WideHanging-Body"><span class="insert5">Specifying the Parallel_Calls 
aspect to be True for a subprogram indicates that the subprogram can 
be safely called in parallel. Conflict checks (if required by the Conflict_Check_Policy 
in effect) are made on the subprogram assuming that multiple concurrent 
calls exist.[ Such checks can then be omitted on a call of the subprogram 
in a parallel iteration context.]</span></div>
<div class="paranum"><a name="p25.a">25.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>Aspect Description 
for&nbsp;</B></span><span class="insert5"><B>Parallel_Calls:&nbsp;</B></span><span class="insert5">Specifies 
whether a given subprogram is expected to be called in parallel.</span></div>

<H4 Class="centered">Implementation Permissions</H4>
<div class="paranum"><a name="p26">26/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0267-1.TXT">AI12-0267-1</A></I>} 
<span class="insert5"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0298-1.TXT">AI12-0298-1</A></I>} 
<span class="insert5">When the conflict check policy Known_Parallel_Conflict_Checks 
or All_Parallel_Conflict_Checks applies, the implementation may disallow 
two concurrent actions appearing within parallel constructs if the implementation 
can prove they will at run-time denote the same object with uses that 
conflict. Similarly, when the conflict check policy Known_Tasking_Conflict_Checks 
or All_Tasking_Conflict_Checks applies, the implementation may disallow 
two concurrent actions, at least one of which appears within a task body 
but not within a parallel construct, if the implementation can prove 
they will at run-time denote the same object with uses that conflict.</span></div>
<div class="paranum"><a name="p26.a">26.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>Ramification:&nbsp;</B>This 
permission allows additional enforcement in instance bodies (where Legality 
Rules aren't usually enforced), in subunits and their parents, and across 
compilation units, if the implementation wishes.</span>&nbsp;</div>

<H4 Class="centered">Extensions to Ada 2012</H4>
<div class="paranum"><a name="p26.b">26.b/5</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0267-1.TXT">AI12-0267-1</A></I>} 
<span class="insert5"><A NAME="I5363"></A>Conflict check policies (and 
the associated checks) are new.</span></div>
<div class="paranum"><a name="p26.c">26.c/5</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0344-1.TXT">AI12-0344-1</A></I>} 
<span class="insert5">Aspect Parallel_Calls is new.</span>&nbsp;</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-9-10.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-9-11.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
