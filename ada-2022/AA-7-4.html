<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Deferred Constants</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    SPAN.insert5 {text-decoration: underline; color: rgb(0,102,0) }
    SPAN.delete5 {text-decoration: line-through; color: rgb(0,102,0) }
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 4.3em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.8em; margin-bottom: 0.6em}
    DIV.Examples {font-family: "Courier New", monospace; font-size: 90%; line-height: 122%; margin-left: 4.0em; margin-bottom: 0.6em}
    DIV.Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,51,153)"><B>Annotated</B></SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)"><B>&nbsp;Ada Reference Manual</B> (Ada 2022 Draft 35)</SPAN> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-7-3-4.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-7-5.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>7.4 Deferred Constants</H1>
<div class="paranum"><a name="p1">1</a></div>
<div class="Normal">[Deferred constant declarations may be used to declare 
constants in the visible part of a package, but with the value of the 
constant given in the private part. They may also be used to declare 
constants imported from other languages (see <A HREF="AA-B.html">Annex 
B</A>).]&nbsp;</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum"><a name="p2">2/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0269-1.TXT">AI05-0269-1</A></I>} 
[<A NAME="I4552"></A> A <I>deferred constant declaration</I> is an <SPAN Class="swiss"><A HREF="AA-3-3-1.html#S0032">object_declaration</A></SPAN> 
with the reserved word <B>constant</B> but no initialization expression.] 
<A NAME="I4553"></A>The constant declared by a deferred constant declaration 
is called a <I>deferred constant</I>. <A NAME="I4554"></A>[Unless the 
Import aspect (see <A HREF="AA-B-1.html">B.1</A>) is True for a deferred 
constant declaration, the] deferred constant declaration requires a completion, 
which shall be a full constant declaration (called the <I>full declaration</I> 
of the deferred constant). <A NAME="I4555"></A></div>
<div class="paranum"><a name="p2.a">2.a</a></div>
<div class="Annotations"><B>Proof:&nbsp;</B>The first sentence is redundant, 
as it is stated officially in <A HREF="AA-3-3-1.html">3.3.1</A>.</div>
<div class="paranum"><a name="p2.b">2.b/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0269-1.TXT">AI05-0269-1</A></I>} 
The first part of the last sentence is redundant, as no imported entity 
may have a completion, as stated in <A HREF="AA-B-1.html">B.1</A>.&nbsp;</div>
<div class="paranum"><a name="p3">3</a></div>
<div class="Normal" style="margin-bottom: 0.4em">A deferred constant 
declaration that is completed by a full constant declaration shall occur 
immediately within the visible part of a <SPAN Class="swiss"><A HREF="AA-7-1.html#S0230">package_specification</A></SPAN>. 
For this case, the following additional rules apply to the corresponding 
full declaration:&nbsp;</div>
<div class="paranum"><a name="p4">4</a></div>
<div class="Bulleted">The full declaration shall occur immediately within 
the private part of the same package;</div>
<div class="paranum"><a name="p5">5/2</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00385.TXT">AI95-00385-01</A></I>} 
The deferred and full constants shall have the same type, or shall have 
statically matching anonymous access subtypes;&nbsp;</div>
<div class="paranum"><a name="p5.a">5.a/2</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00385.TXT">AI95-00385-01</A></I>} 
This implies that both the deferred declaration and the full declaration 
have to have a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
or <SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN> 
rather than an <SPAN Class="swiss"><A HREF="AA-3-6.html#S0051">array_type_definition</A></SPAN>, 
because each <SPAN Class="swiss"><A HREF="AA-3-6.html#S0051">array_type_definition</A></SPAN> 
would define a new type.&nbsp;</div>
<div class="paranum"><a name="p6">6/3</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00385.TXT">AI95-00385-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0062-1.TXT">AI05-0062-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0262-1.TXT">AI05-0262-1</A></I>} 
If the deferred constant declaration includes a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
<I>S</I> that defines a constrained subtype, then the constraint defined 
by the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
in the full declaration shall match the constraint defined by <I>S</I> 
statically.[ On the other hand, if the subtype of the deferred constant 
is unconstrained, then the full declaration is still allowed to impose 
a constraint. The constant itself will be constrained, like all constants;]</div>
<div class="paranum"><a name="p7">7/2</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00231.TXT">AI95-00231-01</A></I>} 
If the deferred constant declaration includes the reserved word <B>aliased</B>, 
then the full declaration shall also;&nbsp;</div>
<div class="paranum"><a name="p7.a">7.a</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>On the other hand, the 
full constant can be aliased even if the deferred constant is not.&nbsp;</div>
<div class="paranum"><a name="p7.1">7.1/2</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00231.TXT">AI95-00231-01</A></I>} 
If the subtype of the deferred constant declaration excludes null, the 
subtype of the full declaration shall also exclude null.&nbsp;</div>
<div class="paranum"><a name="p7.a.1">7.a.1/2</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>On the other hand, the 
full constant can exclude null even if the deferred constant does not. 
But that can only happen for a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN>, 
as anonymous access types are required to statically match (which includes 
any <SPAN Class="swiss"><A HREF="AA-3-10.html#S0083">null_exclusion</A></SPAN>). 
</div>
<div class="paranum"><a name="p8">8/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0444-1.TXT">AI12-0444-1</A></I>} 
[A deferred constant declaration for which the Import aspect is True 
<span class="insert5">can</span><span class="delete5">&nbsp;need not</span> 
appear <span class="insert5">anywhere that an <SPAN Class="swiss"><A HREF="AA-3-3-1.html#S0032">object_declaration</A></SPAN> 
is allowed</span><span class="delete5">&nbsp;in the visible part of a <SPAN Class="swiss"><A HREF="AA-7-1.html#S0230">package_specification</A></SPAN></span>, 
and has no full constant declaration.]</div>
<div class="paranum"><a name="p9">9/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00256.TXT">AI95-00256-01</A></I>} 
The completion of a deferred constant declaration shall occur before 
the constant is frozen (see <A HREF="AA-13-14.html">13.14</A>).</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum"><a name="p10">10/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0004-1.TXT">AI05-0004-1</A></I>} 
<A NAME="I4556"></A>The elaboration of a deferred constant declaration 
elaborates the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN>, 
<SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN>, 
or (only allowed in the case of an imported constant) the <SPAN Class="swiss"><A HREF="AA-3-6.html#S0051">array_type_definition</A></SPAN>. 
</div>
<div class="paranum"><a name="p10.a">10.a/3</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0004-1.TXT">AI05-0004-1</A></I>} 
For nonimported constants, these elaborations cannot require any code 
or checks for a legal program, because the given <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
has to be indefinite or statically match that of the full constant, meaning 
that either it is a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0028">subtype_mark</A></SPAN> 
or it has static constraints. If the deferred constant instead has an 
<SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN>, 
the designated subtype must be a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0028">subtype_mark</A></SPAN>. 
We still say that these are elaborated, however, because part of elaboration 
is creating the type, which is clearly needed for <SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN>s. 
(A deferred constant and its full constant have different types when 
they are specified by an <SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN>, 
although there is no visible effect of these types being different as 
neither can be named.)&nbsp;</div>
<div class="paranum"><a name="p11">11</a></div>
<div class="Notes">NOTE&nbsp;&nbsp;&nbsp;The full constant declaration 
for a deferred constant that is of a given private type or private extension 
is not allowed before the corresponding <SPAN Class="swiss"><A HREF="AA-3-2-1.html#S0024">full_type_declaration</A></SPAN>. 
This is a consequence of the freezing rules for types (see <A HREF="AA-13-14.html">13.14</A>). 
</div>
<div class="paranum"><a name="p11.a">11.a</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>Multiple or single declarations 
are allowed for the deferred and the full declarations, provided that 
the equivalent single declarations would be allowed.</div>
<div class="paranum"><a name="p11.b">11.b</a></div>
<div class="Annotations">Deferred constant declarations are useful for 
declaring constants of private views, and types with components of private 
views. They are also useful for declaring access-to-constant objects 
that designate variables declared in the private part of a package.&nbsp;</div>

<H4 Class="centered">Examples</H4>
<div class="paranum"><a name="p12">12</a></div>
<div class="Normal" style="margin-bottom: 0.4em"><I>Examples of deferred 
constant declarations:</I>&nbsp;</div>
<div class="paranum"><a name="p13">13</a></div>
<div class="Examples">Null_Key&nbsp;:&nbsp;<B>constant</B>&nbsp;Key;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;see&nbsp;<A HREF="AA-7-3-1.html">7.3.1</A></I></SPAN></div>
<div class="paranum"><a name="p14">14/3</a></div>
<div class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
CPU_Identifier&nbsp;:&nbsp;<B>constant</B>&nbsp;String(1..8)<BR>
&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Import&nbsp;=&gt;&nbsp;True,&nbsp;Convention&nbsp;=&gt;&nbsp;Assembler,&nbsp;Link_Name&nbsp;=&gt;&nbsp;&quot;CPU_ID&quot;;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;see&nbsp;<A HREF="AA-B-1.html">B.1</A></I></SPAN></div>

<H4 Class="centered">Extensions to Ada 83</H4>
<div class="paranum"><a name="p14.a">14.a</a></div>
<div class="Annotations"><A NAME="I4557"></A>In Ada 83, a deferred constant 
is required to be of a private type declared in the same visible part. 
This restriction is removed for Ada 95; deferred constants can be of 
any type.</div>
<div class="paranum"><a name="p14.b">14.b</a></div>
<div class="Annotations">In Ada 83, a deferred constant declaration was 
not permitted to include a constraint, nor the reserved word <B>aliased</B>.</div>
<div class="paranum"><a name="p14.c">14.c</a></div>
<div class="Annotations">In Ada 83, the rules required conformance of 
type marks; here we require static matching of subtypes if the deferred 
constant is constrained.</div>
<div class="paranum"><a name="p14.d">14.d</a></div>
<div class="Annotations">A deferred constant declaration can be completed 
with a <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Import. Such a deferred constant declaration need not be within a <SPAN Class="swiss"><A HREF="AA-7-1.html#S0230">package_specification</A></SPAN>.</div>
<div class="paranum"><a name="p14.e">14.e</a></div>
<div class="Annotations">The rules for too-early uses of deferred constants 
are modified in Ada 95 to allow more cases, and catch all errors at compile 
time. This change is necessary in order to allow deferred constants of 
a tagged type without violating the principle that for a dispatching 
call, there is always an implementation to dispatch to. It has the beneficial 
side effect of catching some Ada-83-erroneous programs at compile time. 
The new rule fits in well with the new freezing-point rules. Furthermore, 
we are trying to convert undefined-value problems into bounded errors, 
and we were having trouble for the case of deferred constants. Furthermore, 
uninitialized deferred constants cause trouble for the shared variable 
/ tasking rules, since they are really variable, even though they purport 
to be constant. In Ada 95, they cannot be touched until they become constant.</div>
<div class="paranum"><a name="p14.f">14.f</a></div>
<div class="Annotations">Note that we do not consider this change to 
be an upward incompatibility, because it merely changes an erroneous 
execution in Ada 83 into a compile-time error.</div>
<div class="paranum"><a name="p14.g">14.g</a></div>
<div class="Annotations">The Ada 83 semantics are unclear in the case 
where the full view turns out to be an access type. It is a goal of the 
language design to prevent uninitialized access objects. One wonders 
if the implementation is required to initialize the deferred constant 
to null, and then initialize it (again!) to its real value. In Ada 95, 
the problem goes away.&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 83</H4>
<div class="paranum"><a name="p14.h">14.h/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0299-1.TXT">AI05-0299-1</A></I>} 
Since deferred constants can now be of a nonprivate type, we have made 
this a stand-alone subclause, rather than a subclause of <A HREF="AA-7-3.html">7.3</A>, 
&ldquo;<A HREF="AA-7-3.html">Private Types and Private Extensions</A>&rdquo;.</div>
<div class="paranum"><a name="p14.i">14.i</a></div>
<div class="Annotations">Deferred constant declarations used to have 
their own syntax, but now they are simply a special case of <SPAN Class="swiss"><A HREF="AA-3-3-1.html#S0032">object_declaration</A></SPAN>s. 
</div>

<H4 Class="centered">Extensions to Ada 95</H4>
<div class="paranum"><a name="p14.j">14.j/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00385.TXT">AI95-00385-01</A></I>} 
<A NAME="I4558"></A>Deferred constants were enhanced to allow the use 
of anonymous access types in them.&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 95</H4>
<div class="paranum"><a name="p14.k">14.k/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00231.TXT">AI95-00231-01</A></I>} 
Added matching rules for subtypes that exclude null.&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 2005</H4>
<div class="paranum"><a name="p14.l">14.l/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0062-1.TXT">AI05-0062-1</A></I>} 
<B>Correction:</B> Corrected rules so that the intent that a full constant 
may have a null exclusion even if the deferred constant does not is actually 
met.&nbsp;</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-7-3-4.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-7-5.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
