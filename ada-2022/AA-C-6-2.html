<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>The Package System.Atomic_Operations.Exchange</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    SPAN.insert5 {text-decoration: underline; color: rgb(0,102,0) }
    SPAN.delete5 {text-decoration: line-through; color: rgb(0,102,0) }
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.8em; margin-bottom: 0.6em}
    DIV.Examples {font-family: "Courier New", monospace; font-size: 90%; line-height: 122%; margin-left: 4.0em; margin-bottom: 0.6em}
    DIV.Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,51,153)"><B>Annotated</B></SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)"><B>&nbsp;Ada Reference Manual</B> (Ada 2022 Draft 35)</SPAN> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-C-6-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-C-6-3.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>C.6.2 <span class="insert5">The Package System.Atomic_Operations.Exchange</span><span class="delete5"></span></H1>
<div class="paranum"><a name="p1">1/5</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0234-1.TXT">AI12-0234-1</A></I>} 
<span class="insert5">The language-defined generic package System.Atomic_Operations.Exchange 
provides the following operations:</span></div>
<div class="paranum"><a name="p2">2/5</a></div>
<div class="Bulleted"><span class="insert5">To atomically compare the 
value of two atomic objects, and update the first atomic object with 
a desired value if both objects were found to be equal, or otherwise 
update the second object with the value of the first object.</span></div>
<div class="paranum"><a name="p3">3/5</a></div>
<div class="Bulleted"><span class="insert5">To atomically update the 
value of an atomic object, and then return the value that the atomic 
object had just prior to the update.</span></div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum"><a name="p4">4/5</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0234-1.TXT">AI12-0234-1</A></I>} 
<span class="insert5">The generic library package System.Atomic_Operations.Exchange 
has the following declaration:</span></div>
<div class="paranum"><a name="p5">5/5</a></div>
<div class="Examples"><span class="insert5"><B>generic</B><BR>
&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;Atomic_Type&nbsp;<B>is&nbsp;private&nbsp;with</B>&nbsp;Atomic;<BR>
<B>package</B>&nbsp;System.Atomic_Operations.Exchange<A NAME="I9621"></A><BR>
&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Pure,&nbsp;Nonblocking&nbsp;<B>is</B></span></div>
<div class="paranum"><a name="p6">6/5</a></div>
<div class="Examples"><span class="insert5">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I9622"></A>Atomic_Exchange&nbsp;(Item&nbsp;&nbsp;:&nbsp;<B>aliased&nbsp;in&nbsp;out</B>&nbsp;Atomic_Type;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Value&nbsp;:&nbsp;Atomic_Type)&nbsp;<B>return</B>&nbsp;Atomic_Type<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Convention&nbsp;=&gt;&nbsp;Intrinsic;</span></div>
<div class="paranum"><a name="p7">7/5</a></div>
<div class="Examples"><span class="insert5">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I9623"></A>Atomic_Compare_And_Exchange&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Item&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<B>aliased&nbsp;in&nbsp;out</B>&nbsp;Atomic_Type;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Prior&nbsp;&nbsp;&nbsp;:&nbsp;<B>aliased&nbsp;in&nbsp;out</B>&nbsp;Atomic_Type;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Desired&nbsp;:&nbsp;Atomic_Type)&nbsp;<B>return</B>&nbsp;Boolean<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Convention&nbsp;=&gt;&nbsp;Intrinsic;</span></div>
<div class="paranum"><a name="p8">8/5</a></div>
<div class="Examples"><span class="insert5">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I9624"></A>Is_Lock_Free&nbsp;(Item&nbsp;:&nbsp;<B>aliased</B>&nbsp;Atomic_Type)&nbsp;<B>return</B>&nbsp;Boolean<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Convention&nbsp;=&gt;&nbsp;Intrinsic;</span></div>
<div class="paranum"><a name="p9">9/5</a></div>
<div class="Examples"><span class="insert5"><B>end</B>&nbsp;System.Atomic_Operations.Exchange;</span></div>
<div class="paranum"><a name="p10">10/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0234-1.TXT">AI12-0234-1</A></I>} 
<span class="insert5">Atomic_Exchange atomically assigns the value of 
Value to Item, and returns the previous value of Item.</span></div>
<div class="paranum"><a name="p11">11/5</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0234-1.TXT">AI12-0234-1</A></I>} 
<span class="insert5">Atomic_Compare_And_Exchange first evaluates the 
value of Prior. Atomic_Compare_And_Exchange then performs the following 
steps as part of a single indivisible operation:</span></div>
<div class="paranum"><a name="p12">12/5</a></div>
<div class="Bulleted"><span class="insert5">evaluates the value of Item;</span></div>
<div class="paranum"><a name="p13">13/5</a></div>
<div class="Bulleted"><span class="insert5">compares the value of Item 
with the value of Prior;</span></div>
<div class="paranum"><a name="p14">14/5</a></div>
<div class="Bulleted"><span class="insert5">if equal, assigns Item the 
value of Desired;</span></div>
<div class="paranum"><a name="p15">15/5</a></div>
<div class="Bulleted"><span class="insert5">otherwise, makes no change 
to the value of Item.</span></div>
<div class="paranum"><a name="p16">16/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0234-1.TXT">AI12-0234-1</A></I>} 
<span class="insert5">After these steps, if the value of Item and Prior 
did not match, Prior is assigned the original value of Item, and the 
function returns False. Otherwise, Prior is unaffected and the function 
returns True.</span></div>

<H4 Class="centered">Examples</H4>
<div class="paranum"><a name="p17">17/5</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0234-1.TXT">AI12-0234-1</A></I>} 
<span class="insert5"><I>Example of a spin lock using Atomic_Exchange:</I></span></div>
<div class="paranum"><a name="p18">18/5</a></div>
<div class="Examples"><span class="insert5"><B>type</B>&nbsp;Atomic_Boolean&nbsp;<B>is&nbsp;new</B>&nbsp;Boolean&nbsp;<B>with</B>&nbsp;Atomic;<BR>
<B>package</B>&nbsp;Exchange&nbsp;<B>is&nbsp;new</B><BR>
&nbsp;&nbsp;&nbsp;Atomic_Operations.Exchange&nbsp;(Atomic_Type&nbsp;=&gt;&nbsp;Atomic_Boolean);</span></div>
<div class="paranum"><a name="p19">19/5</a></div>
<div class="Examples"><span class="insert5">Lock&nbsp;:&nbsp;<B>aliased</B>&nbsp;Atomic_Boolean&nbsp;:=&nbsp;False;</span></div>
<div class="paranum"><a name="p20">20/5</a></div>
<div class="Examples"><span class="insert5">...</span></div>
<div class="paranum"><a name="p21">21/5</a></div>
<div class="Examples"><span class="insert5"><B>begin</B>&nbsp;--&nbsp;<SPAN Class="roman"><I>Some&nbsp;critical&nbsp;section,&nbsp;trying&nbsp;to&nbsp;get&nbsp;the&nbsp;lock:</I></SPAN></span></div>
<div class="paranum"><a name="p22">22/5</a></div>
<div class="Examples"><span class="insert5">&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>Obtain&nbsp;the&nbsp;lock</I></SPAN><BR>
&nbsp;&nbsp;&nbsp;<B>while</B>&nbsp;Exchange.Atomic_Exchange&nbsp;(Item&nbsp;=&gt;&nbsp;Lock,&nbsp;Value&nbsp;=&gt;&nbsp;True)&nbsp;<B>loop</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>null</B>;<BR>
&nbsp;&nbsp;&nbsp;<B>end&nbsp;loop</B>;</span></div>
<div class="paranum"><a name="p23">23/5</a></div>
<div class="Examples"><span class="insert5">&nbsp;&nbsp;&nbsp;...&nbsp;--&nbsp;<SPAN Class="roman"><I>Do&nbsp;stuff</I></SPAN></span></div>
<div class="paranum"><a name="p24">24/5</a></div>
<div class="Examples"><span class="insert5">&nbsp;&nbsp;&nbsp;Lock&nbsp;:=&nbsp;False;&nbsp;--&nbsp;<SPAN Class="roman"><I>Release&nbsp;the&nbsp;lock</I></SPAN><BR>
<B>end</B>;</span></div>

<H4 Class="centered">Extensions to Ada 2012</H4>
<div class="paranum"><a name="p24.a">24.a/5</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0234-1.TXT">AI12-0234-1</A></I>} 
<span class="insert5"><A NAME="I9625"></A>This package is new.</span> 
</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-C-6-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-C-6-3.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
