<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Declare Expressions</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    SPAN.insert5 {text-decoration: underline; color: rgb(0,102,0) }
    SPAN.delete5 {text-decoration: line-through; color: rgb(0,102,0) }
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-bottom: 0.6em}
    DIV.Indented1 {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.8em; margin-bottom: 0.6em}
    DIV.Examples {font-family: "Courier New", monospace; font-size: 90%; line-height: 122%; margin-left: 4.0em; margin-bottom: 0.6em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,51,153)"><B>Annotated</B></SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)"><B>&nbsp;Ada Reference Manual</B> (Ada 2022 Draft 35)</SPAN> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-4-5-8.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-4-5-10.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>4.5.9 <span class="insert5">Declare Expressions</span><span class="delete5"></span></H1>
<div class="paranum"><a name="p1">1/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0236-1.TXT">AI12-0236-1</A></I>} 
<span class="insert5">Declare expressions<A NAME="I3467"></A><A NAME="I3468"></A> 
provide a way to declare local constants and object renamings in an expression 
context.</span>&nbsp;</div>

<H4 Class="centered">Syntax</H4>
<div class="paranum"><a name="p2">2/5</a></div>
<div class="Indented1">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0236-1.TXT">AI12-0236-1</A></I>} 
<SPAN Class="swiss"></SPAN><span class="insert5"><SPAN Class="swiss">declare_expression</SPAN></span><SPAN Class="swiss"></SPAN><A NAME="I3469"></A><A NAME="S0156"></A><span class="insert5"><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN></span><span class="insert5"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;<B>declare</B>&nbsp;{<A NAME="I3470"></A><SPAN Class="swiss"><A HREF="AA-4-5-9.html#S0157">declare_item</A></SPAN>}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;<B>begin</B>&nbsp;<I>body_</I><A NAME="I3471"></A><SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN></span></div>
<div class="paranum"><a name="p3">3/5</a></div>
<div class="Indented1">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0236-1.TXT">AI12-0236-1</A></I>} 
<SPAN Class="swiss"></SPAN><span class="insert5"><SPAN Class="swiss">declare_item</SPAN></span><SPAN Class="swiss"></SPAN><A NAME="I3472"></A><A NAME="S0157"></A><span class="insert5"><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN></span><span class="insert5"><A NAME="I3473"></A><SPAN Class="swiss"><A HREF="AA-3-3-1.html#S0032">object_declaration</A></SPAN>&nbsp;|&nbsp;<A NAME="I3474"></A><SPAN Class="swiss"><A HREF="AA-8-5-1.html#S0239">object_renaming_declaration</A></SPAN></span></div>
<div class="paranum"><a name="p3.a">3.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>Reason:&nbsp;</B>We allow 
<TT>(<B>declare begin</B>&nbsp;</TT><SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN><TT>)</TT> 
with no <SPAN Class="swiss"><A HREF="AA-4-5-9.html#S0157">declare_item</A></SPAN>s, 
for uniformity with block statements, which also allow a pointless <B>declare</B>.</span> 
</div>
<div class="paranum"><a name="p4">4/5</a></div>
<div class="Indented1">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0236-1.TXT">AI12-0236-1</A></I>} 
<span class="insert5">Wherever the Syntax Rules allow an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN>, 
a <SPAN Class="swiss"><A HREF="AA-4-5-9.html#S0156">declare_expression</A></SPAN> 
may be used in place of the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN>, 
so long as it is immediately surrounded by parentheses.</span></div>
<div class="paranum"><a name="p4.a">4.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>Discussion:&nbsp;</B>The 
syntactic category <SPAN Class="swiss"><A HREF="AA-4-5-9.html#S0156">declare_expression</A></SPAN> 
appears only as a <SPAN Class="swiss"><A HREF="AA-4-4.html#S0141">primary</A></SPAN> 
that is parenthesized. The above rule allows it to additionally be used 
in other contexts where it would be directly surrounded by parentheses. 
This is the same rule that is used for <SPAN Class="swiss"><A HREF="AA-4-5-7.html#S0148">conditional_expression</A></SPAN>s; 
see <A HREF="AA-4-5-7.html">4.5.7</A> for a detailed discussion of the 
meaning and effects of this rule.</span>&nbsp;</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum"><a name="p5">5/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0236-1.TXT">AI12-0236-1</A></I>} 
<span class="insert5">A <SPAN Class="swiss"><A HREF="AA-4-5-9.html#S0157">declare_item</A></SPAN> 
that is an <SPAN Class="swiss"><A HREF="AA-3-3-1.html#S0032">object_declaration</A></SPAN> 
shall declare a constant of a nonlimited type.</span></div>
<div class="paranum"><a name="p5.a">5.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>Reason:&nbsp;</B>We disallow 
limited objects to avoid the horror of task waiting in the middle of 
an expression. The solution used for controlled objects (wait until the 
entire expression is finished) isn't appropriate for tasks. This restriction 
also eliminates build-in-place complexities and the need to activate 
tasks found in a <SPAN Class="swiss"><A HREF="AA-4-5-9.html#S0157">declare_item</A></SPAN>.</span> 
</div>
<div class="paranum"><a name="p6">6/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0236-1.TXT">AI12-0236-1</A></I>} 
<span class="insert5"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0317-1.TXT">AI12-0317-1</A></I>} 
<span class="insert5">A <SPAN Class="swiss"><A HREF="AA-4-5-9.html#S0157">declare_item</A></SPAN> 
that is an <SPAN Class="swiss"><A HREF="AA-8-5-1.html#S0239">object_renaming_declaration</A></SPAN> 
(see <A HREF="AA-8-5-1.html">8.5.1</A>) shall not rename an object of 
a limited type if any operative constituent of the <I>object_</I><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN> 
is a value conversion or is newly constructed (see <A HREF="AA-4-4.html">4.4</A>).</span></div>
<div class="paranum"><a name="p6.a">6.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>Reason:&nbsp;</B>We disallow 
renaming limited temporary objects (like the result of a function call) 
for the same reasons as for stand-alone objects. We do allow renaming 
existing limited objects because these don't cause any problems. Note 
that one cannot directly rename an <SPAN Class="swiss"><A HREF="AA-4-3.html#S0106">aggregate</A></SPAN>, 
parenthesized expression, <SPAN Class="swiss"><A HREF="AA-4-5-7.html#S0148">conditional_expression</A></SPAN>, 
or <SPAN Class="swiss"><A HREF="AA-4-5-9.html#S0156">declare_expression</A></SPAN> 
(these are not <SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN>s), 
but any of these can appear inside of a <SPAN Class="swiss"><A HREF="AA-4-7.html#S0163">qualified_expression</A></SPAN> 
or <SPAN Class="swiss"><A HREF="AA-4-6.html#S0162">type_conversion</A></SPAN> 
(which are <SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN>s 
and thus can be renamed).</span>&nbsp;</div>
<div class="paranum"><a name="p7">7/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0236-1.TXT">AI12-0236-1</A></I>} 
<span class="insert5">The following are not allowed within a <SPAN Class="swiss"><A HREF="AA-4-5-9.html#S0156">declare_expression</A></SPAN>: 
a declaration containing the reserved word <B>aliased</B>; the <SPAN Class="swiss"><A HREF="AA-4-1-4.html#S0101">attribute_designator</A></SPAN> 
Access or Unchecked_Access; or an anonymous access type.</span></div>
<div class="paranum"><a name="p7.a">7.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>Reason:&nbsp;</B>We do not 
want to define accessibility rules for <SPAN Class="swiss"><A HREF="AA-4-5-9.html#S0157">declare_item</A></SPAN>s, 
as nested <SPAN Class="swiss"><A HREF="AA-4-5-9.html#S0156">declare_expression</A></SPAN>s 
cause complexities or usage warts. We want to keep this feature simple 
to use, understand, and implement. Thus, we do not allow any of the features 
that would require accessibility rules.</span>&nbsp;</div>

<H4 Class="centered">Name Resolution Rules</H4>
<div class="paranum"><a name="p8">8/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0236-1.TXT">AI12-0236-1</A></I>} 
<span class="insert5">If a <SPAN Class="swiss"><A HREF="AA-4-5-9.html#S0156">declare_expression</A></SPAN> 
is expected to be of a type <I>T</I>, then the <I>body_</I><SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN> 
is expected to be of type <I>T</I>. Similarly, if a <SPAN Class="swiss"><A HREF="AA-4-5-9.html#S0156">declare_expression</A></SPAN> 
is expected to be of some class of types, then the <I>body_</I><SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN> 
is subject to the same expectation. If a <SPAN Class="swiss"><A HREF="AA-4-5-9.html#S0156">declare_expression</A></SPAN> 
shall resolve to be of a type <I>T</I>, then the <I>body_</I><SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN> 
shall resolve to be of type <I>T</I>.</span></div>
<div class="paranum"><a name="p9">9/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0236-1.TXT">AI12-0236-1</A></I>} 
<span class="insert5">The type of a <SPAN Class="swiss"><A HREF="AA-4-5-9.html#S0156">declare_expression</A></SPAN> 
is the type of the <I>body_</I><SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN>.</span> 
</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum"><a name="p10">10/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0236-1.TXT">AI12-0236-1</A></I>} 
<span class="insert5">For the evaluation of a <SPAN Class="swiss"><A HREF="AA-4-5-9.html#S0156">declare_expression</A></SPAN>, 
the <SPAN Class="swiss"><A HREF="AA-4-5-9.html#S0157">declare_item</A></SPAN>s 
are elaborated in order, and then the <I>body_</I><SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN> 
is evaluated. The value of the <SPAN Class="swiss"><A HREF="AA-4-5-9.html#S0156">declare_expression</A></SPAN> 
is that of the <I>body_</I><SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN>.</span> 
</div>

<H4 Class="centered">Examples</H4>
<div class="paranum"><a name="p11">11/5</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0236-1.TXT">AI12-0236-1</A></I>} 
<span class="insert5"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0429-1.TXT">AI12-0429-1</A></I>} 
<span class="insert5"><I>Example of use of a declare expression as a 
replacement postcondition for Ada.Containers.Vectors.&quot;&amp;&quot; 
(see <A HREF="AA-A-18-2.html">A.18.2</A>):</I></span></div>
<div class="paranum"><a name="p12">12/5</a></div>
<div class="Examples" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0236-1.TXT">AI12-0236-1</A></I>} 
<span class="insert5"><B>with</B>&nbsp;Post&nbsp;=&gt;<BR>
&nbsp;&nbsp;&nbsp;(<B>declare</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Result&nbsp;<B>renames</B>&nbsp;Vectors.&quot;&amp;&quot;'Result;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Length&nbsp;:&nbsp;<B>constant</B>&nbsp;Count_Type&nbsp;:=&nbsp;Left.Length&nbsp;+&nbsp;Right.Length;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;<B>begin</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Result.Length&nbsp;=&nbsp;Length&nbsp;<B>and&nbsp;then</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>not</B>&nbsp;Tampering_With_Elements_Prohibited&nbsp;(Result)&nbsp;<B>and&nbsp;then</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>not</B>&nbsp;Tampering_With_Cursors_Prohibited&nbsp;(Result)&nbsp;<B>and&nbsp;then</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Result.Capacity&nbsp;&gt;=&nbsp;Length)</span></div>

<H4 Class="centered">Extensions to Ada 2012</H4>
<div class="paranum"><a name="p12.a">12.a/5</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0236-1.TXT">AI12-0236-1</A></I>} 
<span class="insert5"><A NAME="I3475"></A>Declare expressions are new.</span> 
</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-4-5-8.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-4-5-10.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
