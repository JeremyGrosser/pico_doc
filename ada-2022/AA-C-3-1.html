<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Protected Procedure Handlers</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    SPAN.insert5 {text-decoration: underline; color: rgb(0,102,0) }
    SPAN.delete5 {text-decoration: line-through; color: rgb(0,102,0) }
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 4.3em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.8em; margin-bottom: 0.6em}
    DIV.Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.WideHanging-Body {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 7.8em; margin-top: 0em; margin-bottom: 0.6em}
    DIV.WideHanging-Term {float: left; font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-top: 0em; margin-bottom: 0em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,51,153)"><B>Annotated</B></SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)"><B>&nbsp;Ada Reference Manual</B> (Ada 2022 Draft 35)</SPAN> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-C-3.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-C-3-2.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>C.3.1 Protected Procedure Handlers</H1>
<div class="Normal"><SPAN STYLE="font-size: 80%"><I>Paragraphs 1 through 
6 were moved to <A HREF="AA-J.html">Annex J</A>, &ldquo;<A HREF="AA-J.html">Obsolescent 
Features</A>&rdquo;.</I></SPAN>&nbsp;</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum"><a name="p6.1">6.1/3</a></div>
<div class="Normal" style="margin-bottom: 0.4em">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
For a parameterless protected procedure, the following language-defined 
representation aspects may be specified:&nbsp;</div>
<div class="paranum"><a name="p6.2">6.2/3</a></div>
<div class="WideHanging-Term">&nbsp;Interrupt_Handler</div><div class="WideHanging-Body"><br clear="left">
 The type of aspect Interrupt_Handler is Boolean. If directly specified, 
the aspect_definition shall be a static expression. [This aspect is never 
inherited;] if not directly specified, the aspect is False.<A NAME="I9539"></A><A NAME="I9540"></A></div>
<div class="paranum"><a name="p6.a">6.a/3</a></div>
<div class="Annotations"><B>Aspect Description for&nbsp;</B><B>Interrupt_Handler: 
</B>Protected procedure may be attached to interrupts.</div>
<div class="paranum"><a name="p6.3">6.3/3</a></div>
<div class="WideHanging-Term">&nbsp;Attach_Handler</div><div class="WideHanging-Body"><br clear="left">
 The aspect Attach_Handler is an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN>, 
which shall be of type Interrupts.Interrupt_Id. [This aspect is never 
inherited.]<A NAME="I9541"></A><A NAME="I9542"></A></div>
<div class="paranum"><a name="p6.b">6.b/3</a></div>
<div class="Annotations"><B>Aspect Description for&nbsp;</B><B>Attach_Handler: 
</B>Protected procedure is attached to an interrupt.</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum"><a name="p7">7/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00434.TXT">AI95-00434-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0033-1.TXT">AI05-0033-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
If either the Attach_Handler or Interrupt_Handler aspect are specified 
for a protected procedure, the corresponding <SPAN Class="swiss"><A HREF="AA-9-4.html#S0249">protected_type_declaration</A></SPAN> 
or <SPAN Class="swiss"><A HREF="AA-9-4.html#S0250">single_protected_declaration</A></SPAN> 
shall be a library-level declaration and shall not be declared within 
a generic body. <A NAME="I9543"></A>In addition to the places where Legality 
Rules normally apply (see <A HREF="AA-12-3.html">12.3</A>), this rule 
also applies in the private part of an instance of a generic unit.</div>
<div class="paranum"><a name="p7.a">7.a</a></div>
<div class="Annotations"><B>Discussion:&nbsp;</B>In the case of a <SPAN Class="swiss"><A HREF="AA-9-4.html#S0249">protected_type_declaration</A></SPAN>, 
an <SPAN Class="swiss"><A HREF="AA-3-3-1.html#S0032">object_declaration</A></SPAN> 
of an object of that type need not be at library level.</div>
<div class="paranum"><a name="p7.b">7.b/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0033-1.TXT">AI05-0033-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
We cannot allow these aspects in protected declarations in a generic 
body, because legality rules are not checked for instance bodies, and 
these should not be allowed if the instance is not at the library level. 
The protected types can be declared in the private part if this is desired. 
Note that while the 'Access to use the handler would provide the check 
in the case of Interrupt_Handler, there is no other check for Attach_Handler. 
Since these aspects are so similar, we want the rules to be the same. 
</div>
<div class="paranum"><a name="p8">8/3</a></div>
<div class="Normal"><SPAN STYLE="font-size: 80%"><I>This paragraph was 
deleted.</I></SPAN>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00253.TXT">AI95-00253-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00303.TXT">AI95-00303-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0033-1.TXT">AI05-0033-1</A></I>} 
</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum"><a name="p9">9/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
If the Interrupt_Handler aspect of a protected procedure is True, then 
the procedure may be attached dynamically, as a handler, to interrupts 
(see <A HREF="AA-C-3-2.html">C.3.2</A>). [Such procedures are allowed 
to be attached to multiple interrupts.]</div>
<div class="paranum"><a name="p10">10/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<A NAME="I9544"></A><A NAME="I9545"></A>The <SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN> 
specified for the Attach_Handler aspect of a protected procedure <I>P</I> 
is evaluated as part of the creation of the protected object that contains 
<I>P</I>. The value of the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN> 
identifies an interrupt. As part of the initialization of that object, 
<I>P</I> (the <I>handler</I> procedure) is attached to the identified 
interrupt. <A NAME="I9546"></A><A NAME="I9547"></A>A check is made that 
the corresponding interrupt is not reserved. <A NAME="I9548"></A>Program_Error 
is raised if the check fails, and the existing treatment for the interrupt 
is not affected.</div>
<div class="paranum"><a name="p11">11/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00434.TXT">AI95-00434-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<A NAME="I9549"></A><A NAME="I9550"></A><A NAME="I9551"></A>If the Ceiling_Locking 
policy (see <A HREF="AA-D-3.html">D.3</A>) is in effect, then upon the 
initialization of a protected object that contains a protected procedure 
for which either the Attach_Handler aspect is specified or the  Interrupt_Handler 
aspect is True, a check is made that the initial ceiling priority of 
the object is in the range of System.Interrupt_Priority. <A NAME="I9552"></A>If 
the check fails, Program_Error is raised.</div>
<div class="paranum"><a name="p12">12/3</a></div>
<div class="Normal">{<I><A HREF="defect1.html#8652/0068">8652/0068</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00121.TXT">AI95-00121-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<A NAME="I9553"></A>When a protected object is finalized, for any of 
its procedures that are attached to interrupts, the handler is detached. 
If the handler was attached by a procedure in the Interrupts package 
or if no user handler was previously attached to the interrupt, the default 
treatment is restored. If the Attach_Handler aspect was specified and 
the most recently attached handler for the same interrupt is the same 
as the one that was attached at the time the protected object was initialized, 
the previous handler is restored.&nbsp;</div>
<div class="paranum"><a name="p12.a">12.a/3</a></div>
<div class="Annotations"><B>Discussion:&nbsp;</B>{<I><A HREF="defect1.html#8652/0068">8652/0068</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00121.TXT">AI95-00121-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00303.TXT">AI95-00303-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
If all protected objects for interrupt handlers are declared at the library 
level, the finalization discussed above occurs only as part of the finalization 
of all library-level packages in a partition. However, objects of a protected 
type containing procedures with an Attach_Handler aspect specified need 
not be at the library level. Thus, an implementation needs to be able 
to restore handlers during the execution of the program. (An object with 
an Interrupt_Handler aspect also need not be at the library level, but 
such a handler cannot be attached to an interrupt using the Interrupts 
package.)&nbsp;</div>
<div class="paranum"><a name="p13">13</a></div>
<div class="Normal">When a handler is attached to an interrupt, the interrupt 
is blocked [(subject to the Implementation Permission in <A HREF="AA-C-3.html">C.3</A>)] 
during the execution of every protected action on the protected object 
containing the handler.</div>
<div class="paranum"><a name="p13.1">13.1/5</a></div>
<div class="Normal">&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0252-1.TXT">AI12-0252-1</A></I>} 
<span class="insert5">If restriction No_Dynamic_Attachment is in effect, 
then a check is made that the interrupt identified by an Attach_Handler 
aspect does not appear in any previously elaborated Attach_Handler aspect; 
<A NAME="I9554"></A>Program_Error is raised if this check fails.</span></div>
<div class="paranum"><a name="p13.a">13.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>Reason:&nbsp;</B>When No_Dynamic_Attachment 
is in effect, it is not possible to call any previous handler. Therefore, 
the only possibility is to replace the original handler, rendering it 
ineffective. Having an unused handler in a program is likely a bug, so 
we require an exception to be raised.</span>&nbsp;</div>

<H4 Class="centered">Erroneous Execution</H4>
<div class="paranum"><a name="p14">14</a></div>
<div class="Normal"><A NAME="I9555"></A>If the Ceiling_Locking policy 
(see <A HREF="AA-D-3.html">D.3</A>) is in effect and an interrupt is 
delivered to a handler, and the interrupt hardware priority is higher 
than the ceiling priority of the corresponding protected object, the 
execution of the program is erroneous.</div>
<div class="paranum"><a name="p14.1">14.1/3</a></div>
<div class="Normal">&nbsp;&nbsp;{<I><A HREF="defect1.html#8652/0068">8652/0068</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00121.TXT">AI95-00121-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<A NAME="I9556"></A>If the handlers for a given interrupt attached via 
aspect Attach_Handler are not attached and detached in a stack-like (LIFO) 
order, program execution is erroneous. In particular, when a protected 
object is finalized, the execution is erroneous if any of the procedures 
of the protected object are attached to interrupts via aspect Attach_Handler 
and the most recently attached handler for the same interrupt is not 
the same as the one that was attached at the time the protected object 
was initialized.&nbsp;</div>
<div class="paranum"><a name="p14.a">14.a/3</a></div>
<div class="Annotations"><B>Discussion:&nbsp;</B>{<I><A HREF="defect1.html#8652/0068">8652/0068</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00121.TXT">AI95-00121-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
This simplifies implementation of the Attach_Handler aspect by not requiring 
a check that the current handler is the same as the one attached by the 
initialization of a protected object.&nbsp;</div>

<H4 Class="centered">Metrics</H4>
<div class="paranum"><a name="p15">15</a></div>
<div class="Normal" style="margin-bottom: 0.4em">The following metric 
shall be documented by the implementation:&nbsp;</div>
<div class="paranum"><a name="p16">16/2</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00434.TXT">AI95-00434-01</A></I>} 
The worst-case overhead for an interrupt handler that is a parameterless 
protected procedure, in clock cycles. This is the execution time not 
directly attributable to the handler procedure or the interrupted execution. 
It is estimated as C &ndash; (A+B), where A is how long it takes to complete 
a given sequence of instructions without any interrupt, B is how long 
it takes to complete a normal call to a given protected procedure, and 
C is how long it takes to complete the same sequence of instructions 
when it is interrupted by one execution of the same procedure called 
via an interrupt.&nbsp;</div>
<div class="paranum"><a name="p16.a">16.a</a></div>
<div class="Annotations"><B>Implementation Note:&nbsp;</B>The instruction 
sequence and interrupt handler used to measure interrupt handling overhead 
should be chosen so as to maximize the execution time cost due to cache 
misses. For example, if the processor has cache memory and the activity 
of an interrupt handler could invalidate the contents of cache memory, 
the handler should be written such that it invalidates all of the cache 
memory.&nbsp;</div>
<div class="paranum"><a name="p16.b">16.b/2</a></div>
<div class="Annotations"><B>Documentation Requirement:&nbsp;</B>The metrics 
for interrupt handlers.</div>

<H4 Class="centered">Implementation Permissions</H4>
<div class="paranum"><a name="p17">17/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
When the aspects Attach_Handler or Interrupt_Handler are specified for 
a protected procedure, the implementation is allowed to impose implementation-defined 
restrictions on the corresponding <SPAN Class="swiss"><A HREF="AA-9-4.html#S0249">protected_type_declaration</A></SPAN> 
and <SPAN Class="swiss"><A HREF="AA-9-4.html#S0254">protected_body</A></SPAN>. 
</div>
<div class="paranum"><a name="p17.a">17.a</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>The restrictions may be 
on the constructs that are allowed within them, and on ordinary calls 
(i.e. not via interrupts) on protected operations in these protected 
objects.&nbsp;</div>
<div class="paranum"><a name="p17.b">17.b/3</a></div>
<div class="Annotations"><B>Implementation defined:&nbsp;</B>Any restrictions 
on a protected procedure or its containing type when an aspect Attach_handler 
or Interrupt_Handler is specified.</div>
<div class="paranum"><a name="p18">18</a></div>
<div class="Normal">An implementation may use a different mechanism for 
invoking a protected procedure in response to a hardware interrupt than 
is used for a call to that protected procedure from a task.&nbsp;</div>
<div class="paranum"><a name="p18.a">18.a</a></div>
<div class="Annotations"><B>Discussion:&nbsp;</B>This is despite the fact 
that the priority of an interrupt handler (see <A HREF="AA-D-1.html">D.1</A>) 
is modeled after a hardware task calling the handler.&nbsp;</div>
<div class="paranum"><a name="p19">19/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<A NAME="I9557"></A>Notwithstanding what this subclause says elsewhere, 
the Attach_Handler and Interrupt_Handler aspects are allowed to be used 
for other, implementation defined, forms of interrupt handlers.&nbsp;</div>
<div class="paranum"><a name="p19.a">19.a/3</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
For example, if an implementation wishes to allow interrupt handlers 
to have parameters, it is allowed to do so via these aspects; it need 
not invent implementation-defined aspects for the purpose.&nbsp;</div>
<div class="paranum"><a name="p19.b">19.b/3</a></div>
<div class="Annotations"><B>Implementation defined:&nbsp;</B>Any other forms 
of interrupt handler supported by the Attach_Handler and Interrupt_Handler 
aspects.</div>

<H4 Class="centered">Implementation Advice</H4>
<div class="paranum"><a name="p20">20</a></div>
<div class="Normal">Whenever possible, the implementation should allow 
interrupt handlers to be called directly by the hardware.&nbsp;</div>
<div class="paranum"><a name="p20.a">20.a/2</a></div>
<div class="Annotations"><B>Implementation Advice:&nbsp;</B>Interrupt handlers 
should be called directly by the hardware.</div>
<div class="paranum"><a name="p21">21</a></div>
<div class="Normal">Whenever practical, the implementation should detect 
violations of any implementation-defined restrictions before run time. 
</div>
<div class="paranum"><a name="p21.a">21.a/2</a></div>
<div class="Annotations"><B>Implementation Advice:&nbsp;</B>Violations of 
any implementation-defined restrictions on interrupt handlers should 
be detected before run time.</div>
<div class="paranum"><a name="p22">22/5</a></div>
<div class="Notes">NOTE 1&nbsp;&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0440-1.TXT">AI12-0440-1</A></I>} 
The Attach_Handler aspect <span class="insert5">can</span><span class="delete5">&nbsp;may</span> 
provide static attachment of handlers to interrupts if the implementation 
supports preelaboration of protected objects. (See <A HREF="AA-C-4.html">C.4</A>.)</div>
<div class="paranum"><a name="p23">23/5</a></div>
<div class="Notes">NOTE 2&nbsp;&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00434.TXT">AI95-00434-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0442-1.TXT">AI12-0442-1</A></I>} 
<span class="insert5">For a</span><span class="delete5">&nbsp;A</span> protected 
object that has a (protected) procedure attached to an interrupt<span class="insert5">, 
the correct</span><span class="delete5">&nbsp;should</span> <span class="delete5">have 
a&nbsp;</span>ceiling priority<span class="insert5">&nbsp;is</span> at least as 
high as the highest processor priority at which that interrupt will ever 
be delivered.</div>
<div class="paranum"><a name="p24">24</a></div>
<div class="Notes">NOTE 3&nbsp;&nbsp;&nbsp;Protected procedures can also 
be attached dynamically to interrupts via operations declared in the 
predefined package Interrupts.</div>
<div class="paranum"><a name="p25">25</a></div>
<div class="Notes">NOTE 4&nbsp;&nbsp;&nbsp;An example of a possible implementation-defined 
restriction is disallowing the use of the standard storage pools within 
the body of a protected procedure that is an interrupt handler.</div>

<H4 Class="centered">Incompatibilities With Ada 95</H4>
<div class="paranum"><a name="p25.a">25.a/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00253.TXT">AI95-00253-01</A></I>} 
<A NAME="I9558"></A><B>Amendment Correction:</B> Corrected the wording 
so that the rules for the use of Attach_Handler and Interrupt_Handler 
are identical. This means that uses of pragma Interrupt_Handler outside 
of the target protected type or single protected object are now illegal. 
</div>

<H4 Class="centered">Wording Changes from Ada 95</H4>
<div class="paranum"><a name="p25.b">25.b/2</a></div>
<div class="Annotations">{<I><A HREF="defect1.html#8652/0068">8652/0068</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00121.TXT">AI95-00121-01</A></I>} 
<B>Corrigendum:</B> Clarified the meaning of &ldquo;the previous handler&rdquo; 
when finalizing protected objects containing interrupt handlers.</div>
<div class="paranum"><a name="p25.c">25.c/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00303.TXT">AI95-00303-01</A></I>} 
Dropped the requirement that an object of a type containing an Interrupt_Handler 
pragma must be declared at the library level. This was a generic contract 
model violation. This change is not an extension, as an attempt to attach 
such a handler with a routine in package Interrupts will fail an accessibility 
check anyway. Moreover, implementations can retain the rule as an implementation-defined 
restriction on the use of the type, as permitted by the Implementation 
Permissions above.&nbsp;</div>

<H4 Class="centered">Extensions to Ada 2005</H4>
<div class="paranum"><a name="p25.d">25.d/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<A NAME="I9559"></A>Aspects Interrupt_Handler and Attach_Handler are 
new; <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN>s 
Interrupt_Handler and Attach_Handler are now obsolescent.&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 2005</H4>
<div class="paranum"><a name="p25.e">25.e/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0033-1.TXT">AI05-0033-1</A></I>} 
<A NAME="I9560"></A><B>Correction:</B> Added missing generic contract 
wording for the aspects Attach_Handler and Interrupt_Handler.&nbsp;</div>

<H4 Class="centered">Inconsistencies With Ada 2012</H4>
<div class="paranum"><a name="p25.f">25.f/5</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0252-1.TXT">AI12-0252-1</A></I>} 
<span class="insert5"><A NAME="I9561"></A><B>Correction:</B> Program_Error 
might be raised if two handlers are attached when restriction No_Dynamic_Attachment 
is in effect (including as part of the Ravenscar profile). Original Ada 
2012 would have just ignored the first handler. This is almost certainly 
a bug rather than an intended result.</span>&nbsp;</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-C-3.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-C-3-2.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
