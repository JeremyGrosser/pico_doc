<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Shared Variable Control</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 4.3em; margin-bottom: 0.6em}
    DIV.WideHanging-Body {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 7.8em; margin-top: 0em; margin-bottom: 0.6em}
    DIV.WideHanging-Term {float: left; font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-top: 0em; margin-bottom: 0em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,0,153)"><B>Ada Reference Manual</B> (Ada 2022 Draft 35)</SPAN> &mdash; <A HREF="RM-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="RM-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-C-5.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-C-6-1.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>C.6 Shared Variable Control</H1>
<div class="paranum"><a name="p1">1/3</a></div>
<div class="Normal">This subclause defines representation aspects that 
control the use of shared variables.&nbsp;</div>
<div class="Normal"><SPAN STYLE="font-size: 80%"><I>Paragraphs 2 through 
6 were moved to <A HREF="RM-J.html">Annex J</A>, &ldquo;<A HREF="RM-J.html">Obsolescent 
Features</A>&rdquo;.</I></SPAN>&nbsp;</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum"><a name="p6.1">6.1/5</a></div>
<div class="Normal" style="margin-bottom: 0.4em">&nbsp;For an <SPAN Class="swiss"><A HREF="RM-3-3-1.html#S0032">object_declaration</A></SPAN>, 
a <SPAN Class="swiss"><A HREF="RM-3-8.html#S0070">component_declaration</A></SPAN>, 
a <SPAN Class="swiss"><A HREF="RM-3-2-1.html#S0024">full_type_declaration</A></SPAN>, 
or a <SPAN Class="swiss"><A HREF="RM-12-5.html#S0321">formal_complete_type_declaration</A></SPAN>, 
the following representation aspects may be specified:</div>
<div class="paranum"><a name="p6.2">6.2/3</a></div>
<div class="WideHanging-Term">&nbsp;Atomic</div><div class="WideHanging-Body">
The type of aspect Atomic is Boolean.<A NAME="I8625"></A><A NAME="I8626"></A></div>
<div class="paranum"><a name="p6.3">6.3/3</a></div>
<div class="WideHanging-Term">&nbsp;Independent</div><div class="WideHanging-Body">
The type of aspect Independent is Boolean.<A NAME="I8627"></A><A NAME="I8628"></A></div>
<div class="paranum"><a name="p6.4">6.4/3</a></div>
<div class="WideHanging-Term">&nbsp;Volatile</div><div class="WideHanging-Body">
The type of aspect Volatile is Boolean.<A NAME="I8629"></A><A NAME="I8630"></A></div>
<div class="paranum"><a name="p6.5">6.5/5</a></div>
<div class="WideHanging-Term">&nbsp;Full_Access_Only</div><div class="WideHanging-Body"><br clear="left">
The type of aspect Full_Access_Only is Boolean.<A NAME="I8631"></A><A NAME="I8632"></A></div>
<div class="paranum"><a name="p6.6">6.6/5</a></div>
<div class="Normal" style="margin-bottom: 0.4em">&nbsp;For a <SPAN Class="swiss"><A HREF="RM-3-2-1.html#S0024">full_type_declaration</A></SPAN> 
of an array type, an <SPAN Class="swiss"><A HREF="RM-3-3-1.html#S0032">object_declaration</A></SPAN> 
for an object of an anonymous array type, or the <SPAN Class="swiss"><A HREF="RM-12-5.html#S0321">formal_complete_type_declaration</A></SPAN> 
of a formal array type, the following representation aspects may be specified:</div>
<div class="paranum"><a name="p6.7">6.7/3</a></div>
<div class="WideHanging-Term">&nbsp;Atomic_Components</div><div class="WideHanging-Body"><br clear="left">
The type of aspect Atomic_Components is Boolean.<A NAME="I8633"></A><A NAME="I8634"></A></div>
<div class="paranum"><a name="p6.8">6.8/3</a></div>
<div class="WideHanging-Term">&nbsp;Volatile_Components</div><div class="WideHanging-Body"><br clear="left">
The type of aspect Volatile_Components is Boolean.<A NAME="I8635"></A><A NAME="I8636"></A></div>
<div class="paranum"><a name="p6.9">6.9/5</a></div>
<div class="Normal" style="margin-bottom: 0.4em">&nbsp;For a <SPAN Class="swiss"><A HREF="RM-3-2-1.html#S0024">full_type_declaration</A></SPAN> 
of a composite type, an <SPAN Class="swiss"><A HREF="RM-3-3-1.html#S0032">object_declaration</A></SPAN> 
for an object of an anonymous composite type, or the <SPAN Class="swiss"><A HREF="RM-12-5.html#S0321">formal_complete_type_declaration</A></SPAN> 
of a formal composite type, the following representation aspect may be 
specified:</div>
<div class="paranum"><a name="p6.10">6.10/3</a></div>
<div class="WideHanging-Term">&nbsp;&nbsp;Independent_Components</div><div class="WideHanging-Body"><br clear="left">
The type of aspect Independent_Components is Boolean.<A NAME="I8637"></A><A NAME="I8638"></A></div>
<div class="paranum"><a name="p6.11">6.11/5</a></div>
<div class="Normal">&nbsp;&nbsp;If any of these aspects are directly specified, 
the <SPAN Class="swiss"><A HREF="RM-13-1-1.html#S0348">aspect_definition</A></SPAN> 
shall be a static expression. If not specified for a type (including 
by inheritance), the Atomic, Atomic_Components, and Full_Access_Only 
aspects are False. If any of these aspects are specified True for a type, 
then the corresponding aspect is True for all objects of the type. If 
the Atomic aspect is specified True, then the aspects Volatile, Independent, 
and Volatile_Component (if defined) are True; if the Atomic_Components 
aspect is specified True, then the aspects Volatile, Volatile_Components, 
and Independent_Components are True. If the Volatile aspect is specified 
True, then the Volatile_Components aspect (if defined) is True, and vice 
versa. When not determined by one of the other aspects, or for an object 
by its type, the Volatile, Volatile_Components, Independent, and Independent_Components 
aspects are False.</div>
<div class="paranum"><a name="p7">7/3</a></div>
<div class="Normal"><A NAME="I8639"></A>An <I>atomic</I> type is one 
for which the aspect Atomic is True. An <I>atomic</I> object (including 
a component) is one for which the aspect Atomic is True, or a component 
of an array for which the aspect Atomic_Components is True for the associated 
type, or any object of an atomic type, other than objects obtained by 
evaluating a slice.&nbsp;</div>
<div class="paranum"><a name="p8">8/3</a></div>
<div class="Normal"><A NAME="I8640"></A>A <I>volatile</I> type is one 
for which the aspect Volatile is True. A <I>volatile</I> object (including 
a component) is one for which the aspect Volatile is True, or a component 
of an array for which the aspect Volatile_Components is True for the 
associated type, or any object of a volatile type. In addition, every 
atomic type or object is also defined to be volatile. Finally, if an 
object is volatile, then so are all of its subcomponents (the same does 
not apply to atomic).</div>
<div class="paranum"><a name="p8.1">8.1/4</a></div>
<div class="Normal">&nbsp;When True, the aspects Independent and Independent_Components 
<I>specify as independently addressable</I> the named object or component(s), 
or in the case of a type, all objects or components of that type. All 
atomic objects and aliased objects are considered to be specified as 
independently addressable.<A NAME="I8641"></A><A NAME="I8642"></A></div>
<div class="paranum"><a name="p8.2">8.2/5</a></div>
<div class="Normal">&nbsp;The Full_Access_Only aspect shall not be specified 
unless the associated type or object is volatile (or atomic). A <I>full 
access</I> type is any atomic type, or a volatile type for which the 
aspect Full_Access_Only is True.<A NAME="I8643"></A> A <I>full access</I> 
object (including a component) is any atomic object, or a volatile object 
for which the aspect Full_Access_Only is True for the object or its type.<A NAME="I8644"></A> 
A Full_Access_Only aspect is illegal if any subcomponent of the object 
or type is a full access object or is of a generic formal type.</div>
<div class="Normal"><SPAN STYLE="font-size: 80%"><I>Paragraph 9 was moved 
to <A HREF="RM-J.html">Annex J</A>, &ldquo;<A HREF="RM-J.html">Obsolescent 
Features</A>&rdquo;.</I></SPAN>&nbsp;</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum"><a name="p9.1">9.1/3</a></div>
<div class="Normal">&nbsp;If aspect Independent_Components is specified for 
a <SPAN Class="swiss"><A HREF="RM-3-2-1.html#S0024">full_type_declaration</A></SPAN>, 
the declaration shall be that of an array or record type.</div>
<div class="paranum"><a name="p10">10/4</a></div>
<div class="Normal"><A NAME="I8645"></A>It is illegal to specify either 
of the aspects Atomic or Atomic_Components to have the value True for 
an object or type if the implementation cannot support the indivisible 
and independent reads and updates required by the aspect (see below).</div>
<div class="paranum"><a name="p11">11/4</a></div>
<div class="Normal">It is illegal to specify the Size attribute of an 
atomic object, the Component_Size attribute for an array type with atomic 
components, or the layout attributes of an atomic component, in a way 
that prevents the implementation from performing the required indivisible 
and independent reads and updates.</div>
<div class="paranum"><a name="p12">12/5</a></div>
<div class="Normal">If an atomic object is passed as a parameter, then 
the formal parameter shall either have an atomic type or allow pass by 
copy. If an atomic object is used as an actual for a generic formal object 
of mode <B>in out</B>, then the type of the generic formal object shall 
be atomic. If the <SPAN Class="swiss"><A HREF="RM-4-1.html#S0093">prefix</A></SPAN> 
of an <SPAN Class="swiss"><A HREF="RM-4-1-4.html#S0100">attribute_reference</A></SPAN> 
for an Access attribute denotes an atomic object (including a component), 
then the designated type of the resulting access type shall be atomic. 
Corresponding rules apply to volatile objects and to full access objects.</div>
<div class="paranum"><a name="p12.1">12.1/5</a></div>
<div class="Normal">&nbsp;&nbsp;If a nonatomic subcomponent of a full access object 
is passed as an actual parameter in a call then the formal parameter 
shall allow pass by copy (and, at run time, the parameter shall be passed 
by copy). A nonatomic subcomponent of a full access object shall not 
be used as an actual for a generic formal of mode <B>in out</B>. The 
<SPAN Class="swiss"><A HREF="RM-4-1.html#S0093">prefix</A></SPAN> of 
an <SPAN Class="swiss"><A HREF="RM-4-1-4.html#S0100">attribute_reference</A></SPAN> 
for an Access attribute shall not denote a nonatomic subcomponent of 
a full access object.</div>
<div class="paranum"><a name="p12.2">12.2/5</a></div>
<div class="Normal">&nbsp;&nbsp;If the Atomic, Atomic_Components, Volatile, Volatile_Components, 
Independent, Independent_Components, or Full_Access_Only aspect is True 
for a generic formal type, then that aspect shall be True for the actual 
type. If an atomic type is used as an actual for a generic formal derived 
type, then the ancestor of the formal type shall be atomic. A corresponding 
rule applies to volatile types and similarly to full access types.</div>
<div class="paranum"><a name="p12.3">12.3/5</a></div>
<div class="Normal">&nbsp;&nbsp;If a type with volatile components is used as an 
actual for a generic formal array type, then the components of the formal 
type shall be volatile. Furthermore, if the actual type has atomic components 
and the formal array type has aliased components, then the components 
of the formal array type shall also be atomic. A corresponding rule applies 
when the actual type has volatile full access components.</div>
<div class="paranum"><a name="p13">13/3</a></div>
<div class="Normal">If an aspect Volatile, Volatile_Components, Atomic, 
or Atomic_Components is directly specified to have the value True for 
a stand-alone constant object, then the aspect Import shall also be specified 
as True for it.&nbsp;</div>
<div class="paranum"><a name="p13.1">13.1/3</a></div>
<div class="Normal">&nbsp;&nbsp;It is illegal to specify the aspect Independent 
or Independent_Components as True for a component, object or type if 
the implementation cannot provide the independent addressability required 
by the aspect (see <A HREF="RM-9-10.html">9.10</A>).</div>
<div class="paranum"><a name="p13.2">13.2/3</a></div>
<div class="Normal">&nbsp;&nbsp;It is illegal to specify a representation aspect 
for a component, object or type for which the aspect Independent or Independent_Components 
is True, in a way that prevents the implementation from providing the 
independent addressability required by the aspect.</div>
<div class="Normal"><SPAN STYLE="font-size: 80%"><I>Paragraph 14 was 
moved to <A HREF="RM-J.html">Annex J</A>, &ldquo;<A HREF="RM-J.html">Obsolescent 
Features</A>&rdquo;.</I></SPAN>&nbsp;</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum"><a name="p15">15</a></div>
<div class="Normal">For an atomic object (including an atomic component) 
all reads and updates of the object as a whole are indivisible.</div>
<div class="paranum"><a name="p16">16/3</a></div>
<div class="Normal">All tasks of the program (on all processors) that 
read or update volatile variables see the same order of updates to the 
variables. A use of an atomic variable or other mechanism may be necessary 
to avoid erroneous execution and to ensure that access to nonatomic volatile 
variables is sequential (see <A HREF="RM-9-10.html">9.10</A>).</div>
<div class="paranum"><a name="p17">17</a></div>
<div class="Normal"><A NAME="I8646"></A>Two actions are sequential (see 
<A HREF="RM-9-10.html">9.10</A>) if each is the read or update of the 
same atomic object.</div>
<div class="paranum"><a name="p18">18</a></div>
<div class="Normal"><A NAME="I8647"></A>If a type is atomic or volatile 
and it is not a by-copy type, then the type is defined to be a by-reference 
type. If any subcomponent of a type is atomic or volatile, then the type 
is defined to be a by-reference type.</div>
<div class="paranum"><a name="p19">19</a></div>
<div class="Normal">If an actual parameter is atomic or volatile, and 
the corresponding formal parameter is not, then the parameter is passed 
by copy.&nbsp;</div>
<div class="paranum"><a name="p19.1">19.1/5</a></div>
<div class="Normal">&nbsp;&nbsp;All reads of or writes to any nonatomic subcomponent 
of a full access object are performed by reading and/or writing all of 
the nearest enclosing full access object.</div>

<H4 Class="centered">Implementation Requirements</H4>
<div class="paranum"><a name="p20">20/5</a></div>
<div class="Normal"><A NAME="I8648"></A>The external effect of a program 
(see <A HREF="RM-1-1-3.html">1.1.3</A>) is defined to include each read 
and update of a volatile or atomic object. The implementation shall not 
generate any memory reads or updates of atomic or volatile objects other 
than those specified by the program. However, there may be target-dependent 
cases where reading or writing a volatile but nonatomic object (typically 
a component) necessarily involves reading and/or writing neighboring 
storage, and that neighboring storage can overlap a volatile object. 
</div>
<div class="paranum"><a name="p21">21/4</a></div>
<div class="Normal"><SPAN STYLE="font-size: 80%"><I>This paragraph was 
deleted.</I></SPAN></div>

<H4 Class="centered">Implementation Permissions</H4>
<div class="paranum"><a name="p21.1">21.1/5</a></div>
<div class="Normal">&nbsp;&nbsp;Within the body of an instance of a generic unit 
that has a formal type <I>T</I> that is not atomic and an actual type 
that is atomic, if an object <I>O</I> of type <I>T</I> is declared and 
explicitly specified as atomic, the implementation may introduce an additional 
copy on passing <I>O</I> to a subprogram with a parameter of type <I>T</I> 
that is normally passed by reference. A corresponding permission applies 
to volatile parameter passing.&nbsp;</div>

<H4 Class="centered">Implementation Advice</H4>
<div class="paranum"><a name="p22">22/5</a></div>
<div class="Normal">A load or store of a volatile object whose size is 
a multiple of System.Storage_Unit and whose alignment is nonzero, should 
be implemented by accessing exactly the bits of the object and no others, 
except in the case of a volatile but nonatomic subcomponent of an atomic 
object.&nbsp;</div>
<div class="paranum"><a name="p23">23/2</a></div>
<div class="Normal">A load or store of an atomic object should, where 
possible, be implemented by a single load or store instruction.&nbsp;</div>
<div class="paranum"><a name="p24">24</a></div>
<div class="Notes">NOTE 1&nbsp;&nbsp;&nbsp;An imported volatile or atomic 
constant behaves as a constant (i.e. read-only) with respect to other 
parts of the Ada program, but can still be modified by an &ldquo;external 
source&rdquo;.</div>
<div class="paranum"><a name="p25">25/4</a></div>
<div class="Notes">NOTE 2&nbsp;&nbsp;&nbsp;Specifying the Pack aspect 
cannot override the effect of specifying an Atomic or Atomic_Components 
aspect.</div>
<div class="paranum"><a name="p26">26/5</a></div>
<div class="Notes">NOTE 3&nbsp;&nbsp;&nbsp;When mapping an Ada object 
to a memory-mapped hardware register, the Ada object can be declared 
atomic to ensure that the compiler will read and write exactly the bits 
of the register as specified in the source code and no others.</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="RM-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-C-5.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-C-6-1.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
