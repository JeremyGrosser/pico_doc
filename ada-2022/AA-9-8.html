<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Abort of a Task - Abort of a Sequence of Statements</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    SPAN.insert5 {text-decoration: underline; color: rgb(0,102,0) }
    SPAN.delete5 {text-decoration: line-through; color: rgb(0,102,0) }
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-bottom: 0.6em}
    DIV.Indented1 {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 4.3em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.8em; margin-bottom: 0.6em}
    DIV.Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,51,153)"><B>Annotated</B></SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)"><B>&nbsp;Ada Reference Manual</B> (Ada 2022 Draft 35)</SPAN> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-9-7-4.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-9-9.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>9.8 Abort of a Task - Abort of a Sequence of Statements</H1>
<div class="paranum"><a name="p1">1</a></div>
<div class="Normal">[An <SPAN Class="swiss"><A HREF="AA-9-8.html#S0284">abort_statement</A></SPAN> 
causes one or more tasks to become abnormal, thus preventing any further 
interaction with such tasks. The completion of the <SPAN Class="swiss"><A HREF="AA-9-7-4.html#S0282">triggering_statement</A></SPAN> 
of an <SPAN Class="swiss"><A HREF="AA-9-7-4.html#S0280">asynchronous_select</A></SPAN> 
causes a <SPAN Class="swiss"><A HREF="AA-5-1.html#S0166">sequence_of_statements</A></SPAN> 
to be aborted.]&nbsp;</div>

<H4 Class="centered">Syntax</H4>
<div class="paranum"><a name="p2">2</a></div>
<div class="Indented1"><SPAN Class="swiss">abort_statement</SPAN><A NAME="I5302"></A><A NAME="S0284"></A><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN><B>abort</B>&nbsp;<I>task_</I><A NAME="I5303"></A><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN>&nbsp;{,&nbsp;<I>task_</I><A NAME="I5304"></A><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN>};</div>

<H4 Class="centered">Name Resolution Rules</H4>
<div class="paranum"><a name="p3">3/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0444-1.TXT">AI12-0444-1</A></I>} 
<A NAME="I5305"></A>Each <I>task_</I><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN> 
is expected to be of any task type[; <span class="insert5">each can be 
of a different</span><span class="delete5">&nbsp;they need not all be of the 
same</span> task type.]</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum"><a name="p4">4</a></div>
<div class="Normal"><A NAME="I5306"></A>For the execution of an <SPAN Class="swiss"><A HREF="AA-9-8.html#S0284">abort_statement</A></SPAN>, 
the given <I>task_</I><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN>s 
are evaluated in an arbitrary order.<A NAME="I5307"></A> <A NAME="I5308"></A><A NAME="I5309"></A><A NAME="I5310"></A>Each 
named task is then <I>aborted</I>, which consists of making the task 
<I>abnormal</I> and aborting the execution of the corresponding <SPAN Class="swiss"><A HREF="AA-9-1.html#S0248">task_body</A></SPAN>, 
unless it is already completed.&nbsp;</div>
<div class="paranum"><a name="p4.a">4.a/2</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00114.TXT">AI95-00114-01</A></I>} 
Note that aborting those tasks is not defined to be an abort-deferred 
operation. Therefore, if one of the named tasks is the task executing 
the <SPAN Class="swiss"><A HREF="AA-9-8.html#S0284">abort_statement</A></SPAN>, 
or if the task executing the <SPAN Class="swiss"><A HREF="AA-9-8.html#S0284">abort_statement</A></SPAN> 
depends on one of the named tasks, then it is possible for the execution 
of the <SPAN Class="swiss"><A HREF="AA-9-8.html#S0284">abort_statement</A></SPAN> 
to be aborted, thus leaving some of the tasks unaborted. This allows 
the implementation to use either a sequence of calls to an &ldquo;abort 
task&rdquo; run-time system primitive, or a single call to an &ldquo;abort 
list of tasks&rdquo; run-time system primitive.&nbsp;</div>
<div class="paranum"><a name="p5">5</a></div>
<div class="Normal" style="margin-bottom: 0.4em"><A NAME="I5311"></A><A NAME="I5312"></A>When 
the execution of a construct is <I>aborted</I> (including that of a <SPAN Class="swiss"><A HREF="AA-9-1.html#S0248">task_body</A></SPAN> 
or of a <SPAN Class="swiss"><A HREF="AA-5-1.html#S0166">sequence_of_statements</A></SPAN>), 
the execution of every construct included within the aborted execution 
is also aborted, except for executions included within the execution 
of an <I>abort-deferred</I> operation; the execution of an abort-deferred 
operation continues to completion without being affected by the abort; 
<A NAME="I5313"></A>the following are the abort-deferred operations: 
</div>
<div class="paranum"><a name="p6">6</a></div>
<div class="Bulleted">a protected action;</div>
<div class="paranum"><a name="p7">7</a></div>
<div class="Bulleted">waiting for an entry call to complete (after having 
initiated the attempt to cancel it &mdash; see below);</div>
<div class="paranum"><a name="p8">8</a></div>
<div class="Bulleted">waiting for the termination of dependent tasks;</div>
<div class="paranum"><a name="p9">9</a></div>
<div class="Bulleted">the execution of an Initialize procedure as the 
last step of the default initialization of a controlled object;</div>
<div class="paranum"><a name="p10">10</a></div>
<div class="Bulleted">the execution of a Finalize procedure as part of 
the finalization of a controlled object;</div>
<div class="paranum"><a name="p11">11</a></div>
<div class="Bulleted">an assignment operation to an object with a controlled 
part.&nbsp;</div>
<div class="paranum"><a name="p12">12</a></div>
<div class="Normal">[The last three of these are discussed further in 
<A HREF="AA-7-6.html">7.6</A>.]&nbsp;</div>
<div class="paranum"><a name="p12.a">12.a</a></div>
<div class="Annotations"><B>Reason:&nbsp;</B>Deferring abort during Initialize 
and finalization allows, for example, the result of an allocator performed 
in an Initialize operation to be assigned into an access object without 
being interrupted in the middle, which would cause storage leaks. For 
an object with several controlled parts, each individual Initialize is 
abort-deferred. Note that there is generally no semantic difference between 
making each Finalize abort-deferred, versus making a group of them abort-deferred, 
because if the task gets aborted, the first thing it will do is complete 
any remaining finalizations. Individual objects are finalized prior to 
an assignment operation (if nonlimited controlled) and as part of Unchecked_Deallocation. 
</div>
<div class="paranum"><a name="p12.b">12.b</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>Abort is deferred during 
the entire assignment operation to an object with a controlled part, 
even if only some subcomponents are controlled. Note that this says &quot;assignment 
operation&quot;, not &quot;<SPAN Class="swiss"><A HREF="AA-5-2.html#S0173">assignment_statement</A></SPAN>&quot;. 
Explicit calls to Initialize, Finalize, or Adjust are not abort-deferred. 
</div>
<div class="paranum"><a name="p13">13</a></div>
<div class="Normal">When a master is aborted, all tasks that depend on 
that master are aborted.</div>
<div class="paranum"><a name="p14">14</a></div>
<div class="Normal"><A NAME="I5314"></A>The order in which tasks become 
abnormal as the result of an <SPAN Class="swiss"><A HREF="AA-9-8.html#S0284">abort_statement</A></SPAN> 
or the abort of a <SPAN Class="swiss"><A HREF="AA-5-1.html#S0166">sequence_of_statements</A></SPAN> 
is not specified by the language.</div>
<div class="paranum"><a name="p15">15</a></div>
<div class="Normal" style="margin-bottom: 0.4em">If the execution of 
an entry call is aborted, an immediate attempt is made to cancel the 
entry call (see <A HREF="AA-9-5-3.html">9.5.3</A>). If the execution 
of a construct is aborted at a time when the execution is blocked, other 
than for an entry call, at a point that is outside the execution of an 
abort-deferred operation, then the execution of the construct completes 
immediately. For an abort due to an <SPAN Class="swiss"><A HREF="AA-9-8.html#S0284">abort_statement</A></SPAN>, 
these immediate effects occur before the execution of the <SPAN Class="swiss"><A HREF="AA-9-8.html#S0284">abort_statement</A></SPAN> 
completes. Other than for these immediate cases, the execution of a construct 
that is aborted does not necessarily complete before the <SPAN Class="swiss"><A HREF="AA-9-8.html#S0284">abort_statement</A></SPAN> 
completes. However, the execution of the aborted construct completes 
no later than its next <I>abort completion point</I> (if any) that occurs 
outside of an abort-deferred operation; <A NAME="I5315"></A>the following 
are abort completion points for an execution:&nbsp;</div>
<div class="paranum"><a name="p16">16</a></div>
<div class="Bulleted">the point where the execution initiates the activation 
of another task;</div>
<div class="paranum"><a name="p17">17</a></div>
<div class="Bulleted">the end of the activation of a task;</div>
<div class="paranum"><a name="p17.1">17.1/5</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0119-1.TXT">AI12-0119-1</A></I>} 
<span class="insert5">a point within a parallel construct where a new 
logical thread of control is created;</span></div>
<div class="paranum"><a name="p17.2">17.2/5</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0119-1.TXT">AI12-0119-1</A></I>} 
<span class="insert5">the end of a parallel construct;</span></div>
<div class="paranum"><a name="p18">18</a></div>
<div class="Bulleted">the start or end of the execution of an entry call, 
<SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0258">accept_statement</A></SPAN>, 
<SPAN Class="swiss"><A HREF="AA-9-6.html#S0266">delay_statement</A></SPAN>, 
or <SPAN Class="swiss"><A HREF="AA-9-8.html#S0284">abort_statement</A></SPAN>; 
</div>
<div class="paranum"><a name="p18.a">18.a</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>Although the abort completion 
point doesn't occur until the end of the entry call or <SPAN Class="swiss"><A HREF="AA-9-6.html#S0266">delay_statement</A></SPAN>, 
these operations might be cut short because an abort attempts to cancel 
them.&nbsp;</div>
<div class="paranum"><a name="p19">19</a></div>
<div class="Bulleted">the start of the execution of a <SPAN Class="swiss"><A HREF="AA-9-7.html#S0269">select_statement</A></SPAN>, 
or of the <SPAN Class="swiss"><A HREF="AA-5-1.html#S0166">sequence_of_statements</A></SPAN> 
of an <SPAN Class="swiss"><A HREF="AA-11-2.html#S0305">exception_handler</A></SPAN>. 
</div>
<div class="paranum"><a name="p19.a">19.a</a></div>
<div class="Annotations"><B>Reason:&nbsp;</B>The start of an <SPAN Class="swiss"><A HREF="AA-11-2.html#S0305">exception_handler</A></SPAN> 
is considered an abort completion point simply because it is easy for 
an implementation to check at such points.&nbsp;</div>
<div class="paranum"><a name="p19.b">19.b</a></div>
<div class="Annotations"><B>Implementation Note:&nbsp;</B>Implementations 
may of course check for abort more often than at each abort completion 
point; ideally, a fully preemptive implementation of abort will be provided. 
If preemptive abort is not supported in a given environment, then supporting 
the checking for abort as part of subprogram calls and loop iterations 
might be a useful option.&nbsp;</div>

<H4 Class="centered">Bounded (Run-Time) Errors</H4>
<div class="paranum"><a name="p20">20/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0264-1.TXT">AI05-0264-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0445-1.TXT">AI12-0445-1</A></I>} 
<A NAME="I5316"></A>An attempt to execute an <SPAN Class="swiss"><A HREF="AA-9-7-4.html#S0280">asynchronous_select</A></SPAN> 
as part of the execution of an abort-deferred operation is a bounded 
error. Similarly, an attempt to create a task that depends on a master 
that is included entirely within the execution of an abort-deferred operation 
is a bounded error. <A NAME="I5317"></A>In both cases, Program_Error 
is raised if the error is detected by the implementation; otherwise, 
the operations proceed as they would outside an abort-deferred operation, 
except that an abort of the <SPAN Class="swiss"><A HREF="AA-9-7-4.html#S0283">abortable_part</A></SPAN> 
or the created task <span class="insert5">does not necessarily</span><span class="delete5">&nbsp;might 
or might not</span> have an effect.&nbsp;</div>
<div class="paranum"><a name="p20.a">20.a</a></div>
<div class="Annotations"><B>Reason:&nbsp;</B>An <SPAN Class="swiss"><A HREF="AA-9-7-4.html#S0280">asynchronous_select</A></SPAN> 
relies on an abort of the <SPAN Class="swiss"><A HREF="AA-9-7-4.html#S0283">abortable_part</A></SPAN> 
to effect the asynchronous transfer of control. For an <SPAN Class="swiss"><A HREF="AA-9-7-4.html#S0280">asynchronous_select</A></SPAN> 
within an abort-deferred operation, the abort might have no effect.</div>
<div class="paranum"><a name="p20.b">20.b</a></div>
<div class="Annotations">Creating a task dependent on a master included 
within an abort-deferred operation is considered an error, because such 
tasks could be aborted while the abort-deferred operation was still progressing, 
undermining the purpose of abort-deferral. Alternatively, we could say 
that such tasks are abort-deferred for their entire execution, but that 
seems too easy to abuse. Note that task creation is already a bounded 
error in protected actions, so this additional rule only applies to local 
task creation as part of Initialize, Finalize, or Adjust.&nbsp;</div>

<H4 Class="centered">Erroneous Execution</H4>
<div class="paranum"><a name="p21">21</a></div>
<div class="Normal"><A NAME="I5318"></A><A NAME="I5319"></A><A NAME="I5320"></A><A NAME="I5321"></A>If 
an assignment operation completes prematurely due to an abort, the assignment 
is said to be <I>disrupted</I>; the target of the assignment or its parts 
can become abnormal, and certain subsequent uses of the object can be 
erroneous, as explained in <A HREF="AA-13-9-1.html">13.9.1</A>.&nbsp;</div>
<div class="paranum"><a name="p22">22/5</a></div>
<div class="Notes">NOTE 1&nbsp;&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0442-1.TXT">AI12-0442-1</A></I>} 
An <SPAN Class="swiss"><A HREF="AA-9-8.html#S0284">abort_statement</A></SPAN> 
<span class="insert5">is best</span><span class="delete5">&nbsp;should be</span> 
used only in situations requiring unconditional termination.</div>
<div class="paranum"><a name="p23">23</a></div>
<div class="Notes">NOTE 2&nbsp;&nbsp;&nbsp;A task is allowed to abort 
any task it can name, including itself.</div>
<div class="paranum"><a name="p24">24/5</a></div>
<div class="Notes">NOTE 3&nbsp;&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0449-1.TXT">AI12-0449-1</A></I>} 
Additional requirements associated with abort are given in <span class="insert5"><A HREF="AA-D-6.html">D.6</A></span><span class="delete5"><A HREF="AA-D-6.html">&nbsp;D.6</A>, 
&ldquo;<A HREF="AA-D-6.html">Preemptive Abort</A>&rdquo;</span>.&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 83</H4>
<div class="paranum"><a name="p24.a">24.a/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0299-1.TXT">AI05-0299-1</A></I>} 
This subclause has been rewritten to accommodate the concept of aborting 
the execution of a construct, rather than just of a task.&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 2012</H4>
<div class="paranum"><a name="p24.b">24.b/5</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0119-1.TXT">AI12-0119-1</A></I>} 
<span class="insert5">Added points within parallel constructs to the 
list of abort completion points.</span>&nbsp;</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-9-7-4.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-9-9.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
