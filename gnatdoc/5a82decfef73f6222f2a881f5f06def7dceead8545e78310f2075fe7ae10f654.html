<!DOCTYPE html>
<html class=main>
<link rel=stylesheet href=gnatdoc.css><body class=content><h1>BBqueue.Buffers.framed</h1><h2>Entities</h2><h3>Simple Types</h3><ul><li><a href=#7bd0900e53163840270fff5eb47bb18aca2072c6b1dbbe2f86fe87e9fb56d175>Framed_Buffer</a><li><a href=#c0702cf60a4cc9b0243cf9d1717eddc7ce5ef9232b100ed3d41f2e2247dd595f>Read_Grant</a><li><a href=#23f2adf294cc73255b856a2f746d63bdaffc1216519d54fcd9a642fd616e074b>Write_Grant</a></ul><h3>Subtypes</h3><ul><li><a href=#85bfe475833ded1bb414fcd8144ce6f738aa192babb11c6decf6b8be4bf59322>Framed_Count</a></ul><h3>Constants</h3><ul><li><a href=#53b6c633e780ab15f361187b4931222c79c62e6338431f0cc2e628a277a05b25>Max_Frame_Header_Size</a></ul><h3>Subprograms</h3><ul><li><a href=#8cc386bfb268e31324dd31ace44e5acca1b335d04fc57086cb9398052c99ba64>Commit</a><li><a href=#e51c93c2f30e5bf16add1944225e303656b1fa7a77923c84d58e491a82c89773>Empty</a><li><a href=#1ef1452479022526caed5fa2db9bb35c65c60cf88e5105f25032aa81df38e4f4>Empty</a><li><a href=#df6d9db133e77a030ceadf4414597d3c9d202f141b39634026b5ec74d439d0da>Grant</a><li><a href=#5e390c099dab6babbd48012b3191d4a65962ec056d32c0595e306841b3666a1e>Read</a><li><a href=#d49793e33fed0902f03021b64af8b5319762e9b68cc7309ba57af383ecf8e125>Read_Grant_In_Progress</a><li><a href=#2ea3b172607b35a8dbbc720fc8e4c2dc933144071d8fc627e0601145e42e91cf>Release</a><li><a href=#7765ca2d47eb2e39d94a16339c27e8d95ee491ad5e2e3d44cc4cb2163ab364af>Slice</a><li><a href=#d3fd582dbc2e3215003c7b2ae604a357e47dfca2f338d0e992fdbb6965764361>Slice</a><li><a href=#2186651b2d42964f278a42f733d5b677b6f7358d39ccc5a4231dd5f72051604d>State</a><li><a href=#78b7279b20153ae3918b43e5d930415150e40dcf2405671b7cfa5910667eab5d>State</a><li><a href=#3f33dd52abb4d9400cf2b2253df97891d030aa3babe806ffea2e31d7cd8b49d4>Write_Grant_In_Progress</a></ul><h2>Description</h2><p>This unit is based on BBqueue.Buffers and uses markers in the buffer to track the size of each commited write grants. The size of consequent read grants will conrespond to the sizes of commited write grants.<p>It can be used to handle variable lenght packets:<pre><code>Q : aliased Framed_Buffer (64); G : Write_Grant := Empty; G : Read_Grant := Empty; : Slice_Rec;</code></pre><p>begin Grant (Q, WG, 8); -- Get a worst case grant of size 8 Commit (Q, WG, 4); -- Only commit 4 Grant (Q, WG, 8); -- Get a worst case grant of size 8 Commit (Q, WG, 5); -- Only commit 5 Read (W, RG); -- Returns a grant of size 4<h4 id=8cc386bfb268e31324dd31ace44e5acca1b335d04fc57086cb9398052c99ba64>Commit</h4><pre class=ada-code-snippet><code>procedure Commit (This : in out Framed_Buffer;
                  G    : in out Write_Grant;
                  Size :        Framed_Count := Framed_Count'Last)
</code></pre><p>Commit a writeable slice. Size can be smaller than the granted slice for partial commits. The commited slice is then available for Read.<h5>Parameters</h5><dl><dt>This<dd><dt>G<dd><dt>Size<dd></dl><h4 id=e51c93c2f30e5bf16add1944225e303656b1fa7a77923c84d58e491a82c89773>Empty</h4><pre class=ada-code-snippet><code>function Empty return Read_Grant
</code></pre><h5>Return Value</h5><dl><dd></dl><h4 id=1ef1452479022526caed5fa2db9bb35c65c60cf88e5105f25032aa81df38e4f4>Empty</h4><pre class=ada-code-snippet><code>function Empty return Write_Grant
</code></pre><h5>Return Value</h5><dl><dd></dl><h4 id=7bd0900e53163840270fff5eb47bb18aca2072c6b1dbbe2f86fe87e9fb56d175>Framed_Buffer</h4><pre class=ada-code-snippet><code>type Framed_Buffer (Size   : Buffer_Size)
is limited private;
</code></pre><h4 id=85bfe475833ded1bb414fcd8144ce6f738aa192babb11c6decf6b8be4bf59322>Framed_Count</h4><pre class=ada-code-snippet><code>subtype Framed_Count
  is Count range Count'First .. Count'Last - Max_Frame_Header_Size;
</code></pre><p>The frame can take up to 9 bytes in addition to the allocated size. The size of what can be allocated is therefore lower than for a non-framed buffer.<h4 id=df6d9db133e77a030ceadf4414597d3c9d202f141b39634026b5ec74d439d0da>Grant</h4><pre class=ada-code-snippet><code>procedure Grant (This : in out Framed_Buffer;
                 G    : in out Write_Grant;
                 Size : Framed_Count)
</code></pre><p>Request a contiguous writeable slice of the internal buffer<h5>Parameters</h5><dl><dt>This<dd><dt>G<dd><dt>Size<dd></dl><h4 id=53b6c633e780ab15f361187b4931222c79c62e6338431f0cc2e628a277a05b25>Max_Frame_Header_Size</h4><pre class=ada-code-snippet><code>Max_Frame_Header_Size : constant := 9;
</code></pre><h4 id=5e390c099dab6babbd48012b3191d4a65962ec056d32c0595e306841b3666a1e>Read</h4><pre class=ada-code-snippet><code>procedure Read (This : in out Framed_Buffer;
                G    : in out Read_Grant)
</code></pre><p>Request contiguous readable slice from the internal buffer. The size of the returned Read_Grant will be based on the size of previously commited frames.<h5>Parameters</h5><dl><dt>This<dd><dt>G<dd></dl><h4 id=c0702cf60a4cc9b0243cf9d1717eddc7ce5ef9232b100ed3d41f2e2247dd595f>Read_Grant</h4><pre class=ada-code-snippet><code>type Read_Grant is limited private;
</code></pre><h4 id=d49793e33fed0902f03021b64af8b5319762e9b68cc7309ba57af383ecf8e125>Read_Grant_In_Progress</h4><pre class=ada-code-snippet><code>function Read_Grant_In_Progress (This : Framed_Buffer) return Boolean
</code></pre><h5>Parameters</h5><dl><dt>This<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=2ea3b172607b35a8dbbc720fc8e4c2dc933144071d8fc627e0601145e42e91cf>Release</h4><pre class=ada-code-snippet><code>procedure Release (This : in out Framed_Buffer;
                   G    : in out Read_Grant)
</code></pre><p>Release a readable slice. Partial releases not allowed, the full grant will be released.<h5>Parameters</h5><dl><dt>This<dd><dt>G<dd></dl><h4 id=7765ca2d47eb2e39d94a16339c27e8d95ee491ad5e2e3d44cc4cb2163ab364af>Slice</h4><pre class=ada-code-snippet><code>function Slice (G : Read_Grant) return Slice_Rec
</code></pre><h5>Parameters</h5><dl><dt>G<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=d3fd582dbc2e3215003c7b2ae604a357e47dfca2f338d0e992fdbb6965764361>Slice</h4><pre class=ada-code-snippet><code>function Slice (G : Write_Grant) return Slice_Rec
</code></pre><h5>Parameters</h5><dl><dt>G<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=2186651b2d42964f278a42f733d5b677b6f7358d39ccc5a4231dd5f72051604d>State</h4><pre class=ada-code-snippet><code>function State (G : Read_Grant) return Result_Kind
</code></pre><h5>Parameters</h5><dl><dt>G<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=78b7279b20153ae3918b43e5d930415150e40dcf2405671b7cfa5910667eab5d>State</h4><pre class=ada-code-snippet><code>function State (G : Write_Grant) return Result_Kind
</code></pre><h5>Parameters</h5><dl><dt>G<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=23f2adf294cc73255b856a2f746d63bdaffc1216519d54fcd9a642fd616e074b>Write_Grant</h4><pre class=ada-code-snippet><code>type Write_Grant is limited private;
</code></pre><h4 id=3f33dd52abb4d9400cf2b2253df97891d030aa3babe806ffea2e31d7cd8b49d4>Write_Grant_In_Progress</h4><pre class=ada-code-snippet><code>function Write_Grant_In_Progress (This : Framed_Buffer) return Boolean
</code></pre><h5>Parameters</h5><dl><dt>This<dd></dl><h5>Return Value</h5><dl><dd></dl>