<!DOCTYPE html>
<html class=main>
<link rel=stylesheet href=gnatdoc.css><body class=content><h1>USB.HAL.Device</h1><h2>Entities</h2><h3>Simple Types</h3><ul><li><a href=#2421a60af3fd0192b17854531a23a27c6b7cd0f78b4175cef8bbcb62e56ebf17>UDC_Event_Kind</a></ul><h3>Record Types</h3><ul><li><a href=#36fa8d3410167c2b5b597544310c1f3ead7df55016ac2cb177884e4f2e0e9ec0>UDC_Event</a></ul><h3>Interface Types</h3><ul><li><a href=#e26f11defb29684045bd06add1b9892fc2cf671df2fa9729bb646bf6bf583ea8>USB_Device_Controller</a></ul><h3>Access Types</h3><ul><li><a href=#9eb732606f934acd4b0dc28fb9e4a01ddbe90eda5e49d059eb3969885ea04402>Any_USB_Device_Controller</a></ul><h3>Constants</h3><ul><li><a href=#3a798843ed2e764906a19e103d7b2bba3aadaf1bcfadf5a85e3e18b0781cb287>No_Event</a></ul><h3>Subprograms</h3><ul><li><a href=#fc5d2721cf16553a85f48011601f6ebfb160baaff5cd42d3a2f8dc9656988084>Early_Address</a><li><a href=#fcaf952e6a258b94183977f958cf69f85d502bf68f235b4a14737b34f43aa5c2>EP_Ready_For_Data</a><li><a href=#2bc0a03c636fab2f9b7b304fb1b8438c04f39d458df51be080ec5711c79f5f08>EP_Send_Packet</a><li><a href=#ea01bf1cf6868ebfc492a4311aafc60eca7262a6fa0b2cd9a58319075aadac03>EP_Setup</a><li><a href=#87b7e014f39cb2e0fd9584546758def277dbe69a6994bf562e55c455028f5726>EP_Stall</a><li><a href=#beaca97acf37193dcb388c59fae19c7df4e7ef2d50b331b93f83e0c1e3434720>Img</a><li><a href=#f8598fdb5a3be738fc5adef7892d766b22e324a3afe82231c346afb2a4ed15c3>Initialize</a><li><a href=#cc2eb48456cb7fa6cb3760763bfb5723d1073222184798299593d47d7a288cf3>Poll</a><li><a href=#dd055d3698c0519d8c699327bc36923c95ff114e0952e1f2092e1b3ba22e8025>Request_Buffer</a><li><a href=#c8923178af1420d3ea5318e3f65b65b529e90c2fc340642061bbfda38107a0b1>Reset</a><li><a href=#4738588e2d727f6fe977e0060d63eb8e32f5a9c71f07ca8ef48450d7e9eb17d4>Set_Address</a><li><a href=#17e0efca1e5c95bca9c0f5ec52683df7c30431eb8acd5229295a94970c0d308d>Start</a><li><a href=#c4f078e7ff279af15bfb5e8d5e08066d8933e70cf62669d784387e12e175ea65>Valid_EP_Id</a></ul><h2>Description</h2><p>---------------------------------------------------------------------------- -- Copyright (C) 2021, AdaCore -- -- Redistribution and use in source and binary forms, with or without -- modification, are permitted provided that the following conditions are -- met: -- 1. Redistributions of source code must retain the above copyright -- notice, this list of conditions and the following disclaimer. -- 2. Redistributions in binary form must reproduce the above copyright -- notice, this list of conditions and the following disclaimer in -- the documentation and/or other materials provided with the -- distribution. -- 3. Neither the name of the copyright holder nor the names of its -- contributors may be used to endorse or promote products derived -- from this software without specific prior written permission. -- -- THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS -- "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT -- LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR -- A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT -- HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, -- SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT -- LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, -- DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY -- THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT -- (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE -- OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. -- -- ----------------------------------------------------------------------------<h4 id=9eb732606f934acd4b0dc28fb9e4a01ddbe90eda5e49d059eb3969885ea04402>Any_USB_Device_Controller</h4><pre class=ada-code-snippet><code>type Any_USB_Device_Controller is access all USB_Device_Controller'Class;
</code></pre><h4 id=fc5d2721cf16553a85f48011601f6ebfb160baaff5cd42d3a2f8dc9656988084>Early_Address</h4><pre class=ada-code-snippet><code>function Early_Address (This : USB_Device_Controller) return Boolean
</code></pre><p>This function should return True if Set_Address must be called during the processing of the SET_ADDRESS setup request instead of at the end of the setup request. For some reason this is required for the USB controller of the STM32F series.<h5>Parameters</h5><dl><dt>This<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=fcaf952e6a258b94183977f958cf69f85d502bf68f235b4a14737b34f43aa5c2>EP_Ready_For_Data</h4><pre class=ada-code-snippet><code>procedure EP_Ready_For_Data (This    : in out USB_Device_Controller;
                             EP      :        EP_Id;
                             Max_Len :        Packet_Size;
                             Ready   :        Boolean := True)
</code></pre><p>Max_Len has to te less than or equal to the requested buffer size. The transfered will be written to the previously requested EP buffer (see Request_Buffer).<h5>Parameters</h5><dl><dt>This<dd><dt>EP<dd><dt>Max_Len<dd><dt>Ready<dd></dl><h4 id=2bc0a03c636fab2f9b7b304fb1b8438c04f39d458df51be080ec5711c79f5f08>EP_Send_Packet</h4><pre class=ada-code-snippet><code>procedure EP_Send_Packet (This : in out USB_Device_Controller;
                          Ep   :        EP_Id;
                          Len  :        Packet_Size)
</code></pre><p>Len has to te less than or equal to the requested buffer size. The data to transfer is read from the previously requested EP buffer (see Request_Buffer).<h5>Parameters</h5><dl><dt>This<dd><dt>Ep<dd><dt>Len<dd></dl><h4 id=ea01bf1cf6868ebfc492a4311aafc60eca7262a6fa0b2cd9a58319075aadac03>EP_Setup</h4><pre class=ada-code-snippet><code>procedure EP_Setup (This : in out USB_Device_Controller;
                    EP   :        EP_Addr;
                    Typ  :        EP_Type)
</code></pre><p>Setup the given End-Point for the given type of transfer<h5>Parameters</h5><dl><dt>This<dd><dt>EP<dd><dt>Typ<dd></dl><h4 id=87b7e014f39cb2e0fd9584546758def277dbe69a6994bf562e55c455028f5726>EP_Stall</h4><pre class=ada-code-snippet><code>procedure EP_Stall (This : in out USB_Device_Controller;
                    EP   :        EP_Addr;
                    Set  :        Boolean := True)
</code></pre><h5>Parameters</h5><dl><dt>This<dd><dt>EP<dd><dt>Set<dd></dl><h4 id=beaca97acf37193dcb388c59fae19c7df4e7ef2d50b331b93f83e0c1e3434720>Img</h4><pre class=ada-code-snippet><code>function Img (Evt : UDC_Event) return String
</code></pre><h5>Parameters</h5><dl><dt>Evt<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=f8598fdb5a3be738fc5adef7892d766b22e324a3afe82231c346afb2a4ed15c3>Initialize</h4><pre class=ada-code-snippet><code>procedure Initialize (This : in out USB_Device_Controller)
</code></pre><h5>Parameters</h5><dl><dt>This<dd></dl><h4 id=3a798843ed2e764906a19e103d7b2bba3aadaf1bcfadf5a85e3e18b0781cb287>No_Event</h4><pre class=ada-code-snippet><code>No_Event : constant UDC_Event := (Kind => None);
</code></pre><h4 id=cc2eb48456cb7fa6cb3760763bfb5723d1073222184798299593d47d7a288cf3>Poll</h4><pre class=ada-code-snippet><code>function Poll (This : in out USB_Device_Controller) return UDC_Event
</code></pre><h5>Parameters</h5><dl><dt>This<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=dd055d3698c0519d8c699327bc36923c95ff114e0952e1f2092e1b3ba22e8025>Request_Buffer</h4><pre class=ada-code-snippet><code>function Request_Buffer (This          : in out USB_Device_Controller;
                         Ep            :        EP_Addr;
                         Len           :        Packet_Size)
                         return System.Address
</code></pre><p>Allocate a buffer for the given End-Point, either from RAM or interal USB Controller memory depending on the controller. UDC must keep track of the return address to perform IN/OUT transfers (see EP_Write_Packet and EP_Ready_For_Data).<h5>Parameters</h5><dl><dt>This<dd><dt>Ep<dd><dt>Len<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=c8923178af1420d3ea5318e3f65b65b529e90c2fc340642061bbfda38107a0b1>Reset</h4><pre class=ada-code-snippet><code>procedure Reset (This : in out USB_Device_Controller)
</code></pre><p>Called when the host resets the device<h5>Parameters</h5><dl><dt>This<dd></dl><h4 id=4738588e2d727f6fe977e0060d63eb8e32f5a9c71f07ca8ef48450d7e9eb17d4>Set_Address</h4><pre class=ada-code-snippet><code>procedure Set_Address (This : in out USB_Device_Controller;
                       Addr :        UInt7)
</code></pre><h5>Parameters</h5><dl><dt>This<dd><dt>Addr<dd></dl><h4 id=17e0efca1e5c95bca9c0f5ec52683df7c30431eb8acd5229295a94970c0d308d>Start</h4><pre class=ada-code-snippet><code>procedure Start (This : in out USB_Device_Controller)
</code></pre><h5>Parameters</h5><dl><dt>This<dd></dl><h4 id=36fa8d3410167c2b5b597544310c1f3ead7df55016ac2cb177884e4f2e0e9ec0>UDC_Event</h4><pre class=ada-code-snippet><code>type UDC_Event (Kind : UDC_Event_Kind := None) is record
   case Kind is
      when Setup_Request =>
         Req    : Setup_Data;
         Req_EP : EP_Id;
      when Transfer_Complete =>
         EP   : EP_Addr;
         BCNT : Packet_Size;
      when others => null;
   end case;
end record;
</code></pre><h5>Record fields</h5><dl><dt>Kind<dd><dt>Req<dd><dt>Req_EP<dd><dt>EP<dd><dt>BCNT<dd></dl><h4 id=2421a60af3fd0192b17854531a23a27c6b7cd0f78b4175cef8bbcb62e56ebf17>UDC_Event_Kind</h4><pre class=ada-code-snippet><code>type UDC_Event_Kind is (None,
                        Reset,
                        Setup_Request,
                        Transfer_Complete);
</code></pre><h5>Enumeration Literal</h5><dl><dt>None<dd><dt>Reset<dd><dt>Setup_Request<dd><dt>Transfer_Complete<dd></dl><h4 id=e26f11defb29684045bd06add1b9892fc2cf671df2fa9729bb646bf6bf583ea8>USB_Device_Controller</h4><pre class=ada-code-snippet><code>type USB_Device_Controller is interface;
</code></pre><h4 id=c4f078e7ff279af15bfb5e8d5e08066d8933e70cf62669d784387e12e175ea65>Valid_EP_Id</h4><pre class=ada-code-snippet><code>function Valid_EP_Id (This : in out USB_Device_Controller;
                      EP   :        EP_Id)
                      return Boolean
</code></pre><p>Return True if the given EP is valid for this UDC. This is used by the stack to know the number of EPs available.<h5>Parameters</h5><dl><dt>This<dd><dt>EP<dd></dl><h5>Return Value</h5><dl><dd></dl>