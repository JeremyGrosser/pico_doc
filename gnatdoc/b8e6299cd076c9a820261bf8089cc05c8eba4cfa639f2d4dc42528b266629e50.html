<!DOCTYPE html>
<html class=main>
<link rel=stylesheet href=gnatdoc.css><body class=content><h1>BBqueue</h1><h2>Entities</h2><h3>Simple Types</h3><ul><li><a href=#9410fc0f68746bf3322b77c3b4a7255e6549b082f1d0d4660c027bc8f619bb67>Offsets_Only</a><li><a href=#ff1d33f32f2bbf770f22c5c8d55a93989ed589291cd09c5e7cb1c4fd6d086b0e>Read_Grant</a><li><a href=#7971e6102120fbb67bf8f8403fb15360aa4b77117f990f170212d2f5cd35bdac>Result_Kind</a><li><a href=#abf3ac2c3e8884ba58e0a9a40430abc49f6bed2892e526204aaf0b7213e679c4>Write_Grant</a></ul><h3>Record Types</h3><ul><li><a href=#2ecd8d4c234c8adce109010210efd27e3d8abc75b4cd43630d14098011f00e70>Slice_Rec</a></ul><h3>Subtypes</h3><ul><li><a href=#66cd3c513454c2e57e26784ae9f5f7ff8c18e271fc59572f9185fd76c7560d14>Buffer_Offset</a><li><a href=#73dd8064fc722b25341b395334d09d97d0cb59a266971eddd4e562c91ee3e883>Buffer_Size</a><li><a href=#1516c54a8e875b6284bdb8f0922bd448136c59042a43b60bf02db8993777fcde>Count</a></ul><h3>Subprograms</h3><ul><li><a href=#196d0a83bffabaff495734f19dbf66051078e6a35f2f11348761152cfa2765dd>Commit</a><li><a href=#d62ffa71a357d7b91e866fb570c5ef817f19ec43f2b2d0bacdee6013278e8177>Empty</a><li><a href=#f338b30d2f70d416e9792981070501c285490199b4b42de154e62f4c6423da78>Empty</a><li><a href=#866d418945b78653eab044135eea5afb0e2fe7e8123f88328df4ae16a20516d8>Grant</a><li><a href=#9c5c031cb65af68e8ee4f24e195593b7495326f4a095165e41c8c6daa5be6db8>Read</a><li><a href=#0be661c5f6a216ba5e3641c99f6e81ed2066074abe7f6b708bb1da9927347ff2>Read_Grant_In_Progress</a><li><a href=#264420136fe3da99cafc27abd93686d2c6c16369a18949c1867eeec8d134168d>Release</a><li><a href=#8b4e62705c69e81fdaf07045b34ac19e06f9f16adca33e4bda386345297f9de8>Slice</a><li><a href=#edbee08e064e65c62d8e45a3db5dce28e957e6cb2a174bc04bc344a4f95cbb88>Slice</a><li><a href=#78d76d01c3be861b44cfa9167871697de3158fd0b7eca182144d8810b71c9f50>State</a><li><a href=#08131fa8bad93c5d471bfbd9f6ae262cd32be900dd5cdd47782df1bbc6636bf6>State</a><li><a href=#547fa09a2faaa9c76a28f49a95d7606ffe186ca2bc2a7c3a74988ee6c390672f>Valid_Read_Slice</a><li><a href=#253e719b9b06ece8622d247cb81237e9c4707a46a931955acee4b5a60670df9b>Valid_Slice</a><li><a href=#0489e25eff3858d7c6b1ac368f5a4a6fb049598f546535f19d742e62ed4c2787>Valid_Write_Slice</a><li><a href=#eabdf54ce2551e8d9e7bf0e68cd71c29dfc6501991fdc6dd6f8dc4dab64824b8>Write_Grant_In_Progress</a></ul><h2>Description</h2><p>Based on James Munns' https://github.com/jamesmunns/bbqueue<p>BBqueue implements lock free, one producer one consumer, BipBuffers.<p>This unit only handles index offsets without having an internal buffer. It can be used to allocate slices of an existing array, e.g.:<pre><code>Buf : Storage_Array (8 .. 64) := (others => 0); : aliased Offsets_Only (Buf'Length); G : Write_Grant := BBqueue.Empty; : Slice_Rec;</code></pre><p>begin Grant (Q, WG, 8); if State (WG) = Valid then S := Slice (WG); Buf (Buf'First + S.From .. Buf'First + S.To) := (others => 42); Commit (Q, WG); end if;<h4 id=66cd3c513454c2e57e26784ae9f5f7ff8c18e271fc59572f9185fd76c7560d14>Buffer_Offset</h4><pre class=ada-code-snippet><code>subtype Buffer_Offset is Storage_Offset range 0 .. Count'Last - 1;
</code></pre><h4 id=73dd8064fc722b25341b395334d09d97d0cb59a266971eddd4e562c91ee3e883>Buffer_Size</h4><pre class=ada-code-snippet><code>subtype Buffer_Size is Count range 1 .. Count'Last;
</code></pre><h4 id=196d0a83bffabaff495734f19dbf66051078e6a35f2f11348761152cfa2765dd>Commit</h4><pre class=ada-code-snippet><code>procedure Commit (This : in out Offsets_Only;
                  G    : in out Write_Grant;
                  Size :        Count := Count'Last)
</code></pre><p>Commit a writeable slice. Size can be smaller than the granted slice for partial commits. The commited slice is then available for Read.<h5>Parameters</h5><dl><dt>This<dd><dt>G<dd><dt>Size<dd></dl><h4 id=1516c54a8e875b6284bdb8f0922bd448136c59042a43b60bf02db8993777fcde>Count</h4><pre class=ada-code-snippet><code>subtype Count is Storage_Count;
</code></pre><h4 id=d62ffa71a357d7b91e866fb570c5ef817f19ec43f2b2d0bacdee6013278e8177>Empty</h4><pre class=ada-code-snippet><code>function Empty return Read_Grant
</code></pre><h5>Return Value</h5><dl><dd></dl><h4 id=f338b30d2f70d416e9792981070501c285490199b4b42de154e62f4c6423da78>Empty</h4><pre class=ada-code-snippet><code>function Empty return Write_Grant
</code></pre><h5>Return Value</h5><dl><dd></dl><h4 id=866d418945b78653eab044135eea5afb0e2fe7e8123f88328df4ae16a20516d8>Grant</h4><pre class=ada-code-snippet><code>procedure Grant (This : in out Offsets_Only;
                 G    : in out Write_Grant;
                 Size : Count)
</code></pre><p>Request indexes of a contiguous writeable slice of exactly Size elements<h5>Parameters</h5><dl><dt>This<dd><dt>G<dd><dt>Size<dd></dl><h4 id=9410fc0f68746bf3322b77c3b4a7255e6549b082f1d0d4660c027bc8f619bb67>Offsets_Only</h4><pre class=ada-code-snippet><code>type Offsets_Only (Size : Buffer_Size) is limited private;
</code></pre><h4 id=9c5c031cb65af68e8ee4f24e195593b7495326f4a095165e41c8c6daa5be6db8>Read</h4><pre class=ada-code-snippet><code>procedure Read (This : in out Offsets_Only;
                G    : in out Read_Grant;
                Max  :        Count := Count'Last)
</code></pre><p>Request indexes of a contiguous readable slice of up to Max elements<h5>Parameters</h5><dl><dt>This<dd><dt>G<dd><dt>Max<dd></dl><h4 id=ff1d33f32f2bbf770f22c5c8d55a93989ed589291cd09c5e7cb1c4fd6d086b0e>Read_Grant</h4><pre class=ada-code-snippet><code>type Read_Grant is limited private;
</code></pre><h4 id=0be661c5f6a216ba5e3641c99f6e81ed2066074abe7f6b708bb1da9927347ff2>Read_Grant_In_Progress</h4><pre class=ada-code-snippet><code>function Read_Grant_In_Progress (This : Offsets_Only) return Boolean
</code></pre><h5>Parameters</h5><dl><dt>This<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=264420136fe3da99cafc27abd93686d2c6c16369a18949c1867eeec8d134168d>Release</h4><pre class=ada-code-snippet><code>procedure Release (This : in out Offsets_Only;
                   G    : in out Read_Grant;
                   Size :        Count := Count'Last)
</code></pre><p>Release a readable slice. Size can be smaller than the granted slice for partial releases.<h5>Parameters</h5><dl><dt>This<dd><dt>G<dd><dt>Size<dd></dl><h4 id=7971e6102120fbb67bf8f8403fb15360aa4b77117f990f170212d2f5cd35bdac>Result_Kind</h4><pre class=ada-code-snippet><code>type Result_Kind is (Valid, Grant_In_Progress, Insufficient_Size, Empty);
</code></pre><h5>Enumeration Literal</h5><dl><dt>Valid<dd><dt>Grant_In_Progress<dd><dt>Insufficient_Size<dd><dt>Empty<dd></dl><h4 id=8b4e62705c69e81fdaf07045b34ac19e06f9f16adca33e4bda386345297f9de8>Slice</h4><pre class=ada-code-snippet><code>function Slice (G : Read_Grant) return Slice_Rec
</code></pre><h5>Parameters</h5><dl><dt>G<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=edbee08e064e65c62d8e45a3db5dce28e957e6cb2a174bc04bc344a4f95cbb88>Slice</h4><pre class=ada-code-snippet><code>function Slice (G : Write_Grant) return Slice_Rec
</code></pre><h5>Parameters</h5><dl><dt>G<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=2ecd8d4c234c8adce109010210efd27e3d8abc75b4cd43630d14098011f00e70>Slice_Rec</h4><pre class=ada-code-snippet><code>type Slice_Rec is record
   Length : Count;
   From   : Buffer_Offset;
   To     : Buffer_Offset;
end record;
</code></pre><h5>Record fields</h5><dl><dt>Length<dd><dt>From<dd><dt>To<dd></dl><h4 id=78d76d01c3be861b44cfa9167871697de3158fd0b7eca182144d8810b71c9f50>State</h4><pre class=ada-code-snippet><code>function State (G : Read_Grant) return Result_Kind
</code></pre><h5>Parameters</h5><dl><dt>G<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=08131fa8bad93c5d471bfbd9f6ae262cd32be900dd5cdd47782df1bbc6636bf6>State</h4><pre class=ada-code-snippet><code>function State (G : Write_Grant) return Result_Kind
</code></pre><h5>Parameters</h5><dl><dt>G<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=547fa09a2faaa9c76a28f49a95d7606ffe186ca2bc2a7c3a74988ee6c390672f>Valid_Read_Slice</h4><pre class=ada-code-snippet><code>function Valid_Read_Slice (This : Offsets_Only; Slice : Slice_Rec) return Boolean
</code></pre><h5>Parameters</h5><dl><dt>This<dd><dt>Slice<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=253e719b9b06ece8622d247cb81237e9c4707a46a931955acee4b5a60670df9b>Valid_Slice</h4><pre class=ada-code-snippet><code>function Valid_Slice (This : Offsets_Only; Slice : Slice_Rec) return Boolean
</code></pre><p>A valid slice contains offsets within the bounds of the array range. This ensures that: Arr (Arr'First + Start_Offset .. Arr'First + End_Offset) will never be out of bounds.<h5>Parameters</h5><dl><dt>This<dd><dt>Slice<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=0489e25eff3858d7c6b1ac368f5a4a6fb049598f546535f19d742e62ed4c2787>Valid_Write_Slice</h4><pre class=ada-code-snippet><code>function Valid_Write_Slice (This : Offsets_Only; Slice : Slice_Rec) return Boolean
</code></pre><h5>Parameters</h5><dl><dt>This<dd><dt>Slice<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=abf3ac2c3e8884ba58e0a9a40430abc49f6bed2892e526204aaf0b7213e679c4>Write_Grant</h4><pre class=ada-code-snippet><code>type Write_Grant is limited private;
</code></pre><h4 id=eabdf54ce2551e8d9e7bf0e68cd71c29dfc6501991fdc6dd6f8dc4dab64824b8>Write_Grant_In_Progress</h4><pre class=ada-code-snippet><code>function Write_Grant_In_Progress (This : Offsets_Only) return Boolean
</code></pre><h5>Parameters</h5><dl><dt>This<dd></dl><h5>Return Value</h5><dl><dd></dl>